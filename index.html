<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BAKFON — Satış & Anbar Sistemi</title>
    <style>
        :root {
            --bg: #f8fafc; --text: #0f172a; --card: #ffffff; --border: #e2e8f0; --muted: #64748b; --primary: #4f46e5;
            --ring: rgba(99, 102, 241, .5); --shadow: 0 10px 15px -3px rgba(0, 0, 0, .1), 0 4px 6px -2px rgba(0, 0, 0, .05); --radius: 12px;
            --danger: #ef4444; --success: #22c55e;
        }
        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.55; }
        .app { display: grid; grid-template-rows: 56px 1fr; height: 100%; }
        .topbar { display: flex; align-items: center; justify-content: space-between; padding: 0 16px; background: linear-gradient(to right, #6366f1, #4f46e5); color: #eef2ff; border-bottom: 1px solid rgba(0, 0, 0, .1); box-shadow: var(--shadow); }
        .brand { font-weight: 800; font-size: 1.2rem; }
        .top-actions { display: flex; gap: 8px; align-items: center; }
        .muted-light { color: rgba(255, 255, 255, .6); font-size: 14px; }
        .brand-logo { height: 40px; margin-right: 10px; }
        .shell { display: grid; grid-template-columns: 270px 1fr; height: 100%; }
        .sidebar { background: #f1f5f9; padding: 14px 12px; border-right: 1px solid var(--border); box-shadow: inset -2px 0 4px -2px rgba(0, 0, 0, .05); }
        .navgroup { margin: 8px 0 10px; font-size: 12px; color: #475569; font-weight: 800; opacity: .9; }
        .navbtn { width: 100%; text-align: left; padding: 10px 12px; border-radius: var(--radius); border: 1px solid #cbd5e1; background: #fff; cursor: pointer; font-weight: 700; margin-bottom: 8px; color: var(--text); transition: all .2s ease-in-out; }
        .navbtn:hover { background: #f8fafc; border-color: #94a3b8; }
        .navbtn.active { background: var(--primary); color: #fff; border-color: var(--primary); box-shadow: 0 4px 6px rgba(79, 70, 229, .2); }
        .content { padding: 16px; overflow: auto; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 18px; margin-bottom: 14px; box-shadow: var(--shadow); }
        .row { display: grid; gap: 14px; }
        @media(min-width:720px) { .row { grid-template-columns: repeat(12, 1fr); } }
        .col-12 { grid-column: span 12; } .col-8 { grid-column: span 8; } .col-6 { grid-column: span 6; } .col-4 { grid-column: span 4; } .col-3 { grid-column: span 3; }
        label { font-size: 13px; color: #475569; font-weight: 600; }
        input, select, textarea { width: 100%; padding: 12px; border-radius: var(--radius); border: 1px solid var(--border); background: #fff; outline: none; transition: box-shadow .12s, border-color .12s; }
        input:focus, select:focus, textarea:focus, .btn:focus { box-shadow: 0 0 0 3px var(--ring); border-color: var(--primary); }
        .btn { border: 1px solid #cbd5e1; background: #f1f5f9; color: #0f172a; padding: 11px 16px; border-radius: var(--radius); cursor: pointer; transition: .15s; box-shadow: var(--shadow); font-weight: 700; }
        .btn:hover { transform: translateY(-1px); } .btn:active { transform: translateY(0); }
        .btn.primary { background: var(--primary); border-color: var(--primary); color: #fff; }
        .btn.success { background: var(--success); border-color: var(--success); color: #fff; }
        .btn.danger { background: var(--danger); border-color: var(--danger); color: #fff; }
        .btn.primary:hover { background: #4338ca; } .btn.success:hover { background: #15803d; } .btn.danger:hover { background: #be123c; }
        .muted { color: var(--muted); font-size: 14px; }
        .invalid { border-color: var(--danger) !important; box-shadow: 0 0 0 3px rgba(239, 68, 68, .12); }
        .notice { padding: 12px 16px; border-radius: var(--radius); font-weight: 500; margin-bottom: 12px; }
        .notice.warn { background: rgba(251, 191, 36, .1); border: 1px solid #fcd34d; color: #92400e; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; background: #fff; border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
        thead th { background: #f8fafc; padding: 10px; font-weight: 700; font-size: 14px; border-bottom: 1px solid var(--border); text-align: right; }
        tbody td { padding: 10px; border-bottom: 1px solid var(--border); font-size: 13px; text-align: right; }
        tbody tr:last-child td { border-bottom: none; }
        tbody tr:nth-child(odd) { background: rgba(2, 6, 23, .02); }
        tfoot td { padding: 10px; background: #f1f5f9; font-weight: 700; border-top: 1px solid var(--border); text-align: right; }
        .text-left { text-align: left !important; }
        .text-center { text-align: center !important; }
        .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(2, 6, 23, .4); z-index: 50; backdrop-filter: blur(3px); }
        .modal.show { display: flex; }
        .modal-card { width: min(1000px, 96vw); max-height: 92vh; overflow: auto; background: #fff; border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); padding: 24px; position: relative; }
        .modal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .x { background: #fff; border: 1px solid #e2e8f0; border-radius: 10px; padding: 6px 10px; cursor: pointer; }
    </style>
</head>
<body>
<div id="login-page" style="display:flex;justify-content:center;align-items:center;height:100vh;background-color:#f1f5f9;">
    <div style="width:100%; max-width:400px; padding:2rem; background-color:#fff; border-radius:16px; box-shadow:0 10px 25px -5px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05); text-align:center; border:1px solid #e2e8f0;">
        <img src="https://i.ibb.co/6P01x6N/Screenshot-2025-09-13-at-15-07-28.png" alt="BAKFON Logo" style="width:180px; margin-bottom:1.5rem;">
        <h2 style="margin-bottom:1rem;color:#111827">Giriş</h2>
        <div id="login-error" class="notice warn" style="display:none;margin-top:10px;"></div>
        <div class="row">
            <div class="col-12"><label style="text-align:left;display:block">İstifadəçi adı</label><input id="login-username" type="text" placeholder="İstifadəçi adı"></div>
            <div class="col-12"><label style="text-align:left;display:block">Şifrə</label><input id="login-password" type="password" placeholder="Şifrə"></div>
            <div class="col-12"><button id="login-btn" class="btn primary" style="width:100%;margin-top:10px;">Daxil ol</button></div>
        </div>
        <p style="font-size:12px;color:#94a3b8;margin-top:20px;">Demo: admin / 123456</p>
    </div>
</div>

<div class="app" id="main-app" style="display:none">
    <div class="topbar">
        <div class="brand"><img src="https://i.ibb.co/6P01x6N/Screenshot-2025-09-13-at-15-07-28.png" alt="BAKFON Logo" class="brand-logo"></div>
        <div class="top-actions">
            <div class="muted-light" id="user-info"></div>
            <button id="logout-btn" class="btn" style="background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.2);color:white;font-weight:400">Çıxış</button>
        </div>
    </div>

    <div class="shell">
        <aside class="sidebar" id="sidebar">
            <div class="navgroup">Əsas</div>
            <button class="navbtn active" data-view="dashboard">Ana Səhifə</button>
            <button class="navbtn" data-view="inventory">Anbar</button>
            <button class="navbtn" data-view="sales">Satışlar</button>
            <button class="navbtn" data-view="customers">Müştərilər</button>
            <div class="navgroup">Əlavə</div>
            <button class="navbtn" data-view="reports">Hesabatlar</button>
            <button class="navbtn" data-view="calculator">Kredit Kalkulyator</button>
            <button class="navbtn" data-view="settings">Ayarlar</button>
        </aside>

        <main class="content">
            <section id="view-dashboard" class="card" style="min-height:120px">
                <h3>Dashboard</h3>
                <div class="row">
                    <div class="col-4 card"><h4 style="margin:0">Bugünkü Satış</h4><p style="font-size:1.5rem;font-weight:700;margin:0" id="todaySales">0.00 ₼</p></div>
                    <div class="col-4 card"><h4 style="margin:0">Ayın Mənfəəti</h4><p style="font-size:1.5rem;font-weight:700;margin:0" id="monthProfit">0.00 ₼</p></div>
                    <div class="col-4 card"><h4 style="margin:0">Anbardakı məhsul sayı</h4><p style="font-size:1.5rem;font-weight:700;margin:0" id="invCount">0 ədəd</p></div>
                </div>
            </section>

            <section id="view-inventory" class="card" style="display:none">
                <h3>Anbar İdarəetməsi</h3>
                <div id="inv-alert" class="notice warn" style="display:none"></div>
                <div class="row">
                    <div class="col-3"><label>SKU</label><input id="invSku"></div>
                    <div class="col-3"><label>Ad</label><input id="invName"></div>
                    <div class="col-3"><label>Satış qiyməti (AZN)</label><input id="invPrice" type="number" step="0.01"></div>
                    <div class="col-3"><label>Maya (AZN)</label><input id="invCost" type="number" step="0.01"></div>
                    <div class="col-3"><label>Miqdar</label><input id="invQty" type="number" step="1"></div>
                    <div class="col-12"><button id="btnAddInv" class="btn primary">Məhsul əlavə/yenilə</button></div>
                </div>
                <div class="row card" style="margin:12px 0">
                    <div class="col-12"><label>Axtarış</label><input id="invSearch" placeholder="SKU / Ad"></div>
                </div>
                <div id="inventoryTable"></div>
            </section>

            <section id="view-sales" class="card" style="display:none">
                <h3>Yeni Satış</h3>
                <div id="sale-alert" class="notice warn" style="display:none"></div>
                <div class="row">
                    <div class="col-3"><label>Müştəri FIN</label><input id="saleFin" placeholder="Müştəri FIN kodunu daxil edin"></div>
                    <div class="col-3"><label>Məhsul SKU</label><input id="saleSku" placeholder="Məhsul SKU daxil edin"></div>
                    <div class="col-3"><label>Miqdar</label><input id="saleQty" type="number" value="1" min="1"></div>
                    <div class="col-3"><label>Satış növü</label><select id="saleType"><option value="cash">Nağd</option><option value="credit">Kredit</option><option value="pos">POS</option></select></div>
                    <div class="col-3"><label>Satış qiyməti (AZN)</label><input id="salePrice" type="number" step="0.01"></div>
                    <div class="col-3"><label>IMEI (opsional)</label><input id="saleImei"></div>
                    <div class="col-12"><button id="btnMakeSale" class="btn success">Satışı tamamla</button></div>
                </div>
                <div id="salesTable" class="card" style="margin-top:12px"></div>
            </section>

            <section id="view-customers" class="card" style="display:none">
                <h3>Müştərilər</h3>
                <div id="customer-alert" class="notice warn" style="display:none"></div>
                <div class="row">
                    <div class="col-4"><label>Ad Soyad</label><input id="custName"></div>
                    <div class="col-4"><label>FIN Kodu</label><input id="custFin"></div>
                    <div class="col-4"><label>Telefon</label><input id="custPhone"></div>
                    <div class="col-12"><button id="btnAddCustomer" class="btn primary">Müştəri əlavə et</button></div>
                </div>
                <div id="customerSearch" class="card" style="margin-top:12px">
                    <label>Müştəri axtar</label><input id="searchCustomer" placeholder="Ad, FIN və ya telefon nömrəsi">
                </div>
                <div id="customersTable" class="card" style="margin-top:12px"></div>
            </section>

            <section id="view-reports" class="card" style="display:none">
                <h3>Hesabatlar</h3>
                <div class="row">
                    <div class="col-4"><label>Başlanğıc tarixi</label><input id="repFrom" type="date"></div>
                    <div class="col-4"><label>Bitiş tarixi</label><input id="repTo" type="date"></div>
                    <div class="col-12"><button id="btnRunReport" class="btn primary">Hesabatı hazırla</button></div>
                </div>
                <div id="reportSummary" class="card" style="margin-top:12px"></div>
                <div id="reportTable" class="card"></div>
            </section>

            <section id="view-calculator" class="card" style="display:none">
                <h3>Kredit Kalkulyatoru</h3>
                <div id="calc-alert" class="notice warn" style="display:none"></div>
                <div class="row">
                    <div class="col-4"><label>Məhsul dəyəri (AZN)</label><input id="calcPrice" type="number" min="0" step="0.01"></div>
                    <div class="col-3"><label>Müddət (ay)</label><select id="calcMonths"><option value="">— Seçin —</option><option>3</option><option>6</option><option>9</option><option>12</option></select></div>
                    <div class="col-12"><button id="btnCalc" class="btn success">Hesabla</button></div>
                </div>
                <div id="calcResult" class="card" style="margin-top:12px;display:none"></div>
            </section>

            <section id="view-settings" class="card" style="display:none">
                <h3>Ayarlar</h3>
                <p>Burada şirkət məlumatları, istifadəçilər və digər parametrlər idarə oluna bilər.</p>
                <div class="row">
                    <div class="col-12"><label>Şirkət Adı</label><input id="companyName"></div>
                    <div class="col-12"><button id="btnSaveSettings" class="btn primary">Yadda saxla</button></div>
                </div>
            </section>
        </main>
    </div>
</div>

<script>
    /* ===== Utility Functions ===== */
    const $ = id => document.getElementById(id);
    const nowISO = () => new Date().toISOString().slice(0, 10);
    const fmtAZN = n => new Intl.NumberFormat('az-AZ', { style: 'currency', currency: 'AZN', maximumFractionDigits: 2 }).format(Number(n) || 0);
    const show = (elId) => $(elId).style.display = 'block';
    const hide = (elId) => $(elId).style.display = 'none';
    const showMessage = (elId, msg) => { $(elId).innerHTML = msg; show(elId); };
    const hideMessage = (elId) => hide(elId);

    /* ===== LOCAL STORAGE KEYS ===== */
    const DB = {
        PRODUCTS: 'bakfon_products',
        SALES: 'bakfon_sales',
        CUSTOMERS: 'bakfon_customers',
        SETTINGS: 'bakfon_settings'
    };
    const getJSON = (key, def = []) => { try { return JSON.parse(localStorage.getItem(key)) || def; } catch (e) { return def; } };
    const setJSON = (key, val) => localStorage.setItem(key, JSON.stringify(val));
    
    /* ===== DEMO DATA ===== */
    const createDemoData = () => {
        if (localStorage.getItem(DB.PRODUCTS)) return;
        setJSON(DB.PRODUCTS, [
            { sku: "IP15PRO", name: "iPhone 15 Pro", price: 2350, cost: 2100, quantity: 15 },
            { sku: "S24U", name: "Samsung Galaxy S24 Ultra", price: 2100, cost: 1950, quantity: 20 },
            { sku: "HUAWEIP60", name: "Huawei P60 Pro", price: 1800, cost: 1620, quantity: 8 },
            { sku: "MACBOOKAIR", name: "MacBook Air M2", price: 2500, cost: 2200, quantity: 10 }
        ]);
        setJSON(DB.SALES, [
            { date: nowISO(), fin: "AZE12345", sku: "IP15PRO", quantity: 1, price: 2350, type: "cash" },
            { date: "2025-09-19", fin: "AZE67890", sku: "S24U", quantity: 1, price: 2100, type: "credit" }
        ]);
        setJSON(DB.CUSTOMERS, [
            { name: "Əli Əliyev", fin: "AZE12345", phone: "050-123-45-67" },
            { name: "Vüsal Vəliyev", fin: "AZE67890", phone: "055-987-65-43" }
        ]);
    };
    createDemoData();

    /* ===== AUTH ===== */
    const users = { 'admin': '123456' };
    const loginPage = $('login-page');
    const mainApp = $('main-app');
    const loginBtn = $('login-btn');
    const logoutBtn = $('logout-btn');
    const loginUsername = $('login-username');
    const loginPassword = $('login-password');
    const userInfo = $('user-info');
    
    function login() {
        if (users[loginUsername.value] === loginPassword.value) {
            localStorage.setItem('currentUser', loginUsername.value);
            renderApp();
        } else {
            showMessage('login-error', 'İstifadəçi adı və ya şifrə yanlışdır.');
        }
    }

    function logout() {
        localStorage.removeItem('currentUser');
        renderApp();
    }

    function renderApp() {
        if (localStorage.getItem('currentUser')) {
            hide('login-page');
            show('main-app');
            userInfo.textContent = `İstifadəçi: ${localStorage.getItem('currentUser')}`;
            goto('dashboard');
        } else {
            show('login-page');
            hide('main-app');
        }
    }

    loginBtn.addEventListener('click', login);
    logoutBtn.addEventListener('click', logout);
    document.addEventListener('DOMContentLoaded', renderApp);

    /* ===== NAVIGATION ===== */
    function goto(viewId) {
        document.querySelectorAll('section').forEach(sec => hide(sec.id));
        show('view-' + viewId);
        document.querySelectorAll('.navbtn').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.navbtn[data-view="${viewId}"]`).classList.add('active');
        if (viewId === 'dashboard') renderDashboard();
        if (viewId === 'inventory') renderInventory();
        if (viewId === 'sales') renderSales();
        if (viewId === 'customers') renderCustomers();
        if (viewId === 'reports') renderReports();
    }
    document.getElementById('sidebar').addEventListener('click', (e) => {
        const view = e.target.closest('.navbtn')?.dataset.view;
        if (view) goto(view);
    });

    /* ===== DASHBOARD ===== */
    function renderDashboard() {
        const sales = getJSON(DB.SALES);
        const products = getJSON(DB.PRODUCTS);

        const today = nowISO();
        const todaySales = sales.filter(s => s.date === today);
        const totalTodaySales = todaySales.reduce((sum, s) => sum + s.price, 0);

        const thisMonthStart = new Date().toISOString().slice(0, 7);
        const monthSales = sales.filter(s => s.date.startsWith(thisMonthStart));
        const totalMonthProfit = monthSales.reduce((sum, s) => {
            const product = products.find(p => p.sku === s.sku);
            return sum + (s.price - (product?.cost || 0));
        }, 0);

        const totalInvCount = products.reduce((sum, p) => sum + (p.quantity || 0), 0);
        
        $('todaySales').textContent = fmtAZN(totalTodaySales);
        $('monthProfit').textContent = fmtAZN(totalMonthProfit);
        $('invCount').textContent = totalInvCount + ' ədəd';
    }

    /* ===== INVENTORY ===== */
    function renderInventory() {
        const products = getJSON(DB.PRODUCTS);
        const query = ($('invSearch').value || '').toLowerCase();
        const filteredProducts = products.filter(p => p.sku.toLowerCase().includes(query) || p.name.toLowerCase().includes(query));
        
        let html = `<table><thead><tr><th>SKU</th><th>Ad</th><th>Qiymət</th><th>Maya</th><th>Miqdar</th><th>Əməliyyat</th></tr></thead><tbody>`;
        filteredProducts.forEach(p => {
            html += `<tr>
                <td>${p.sku}</td>
                <td class="text-left">${p.name}</td>
                <td>${fmtAZN(p.price)}</td>
                <td>${fmtAZN(p.cost)}</td>
                <td>${p.quantity}</td>
                <td><button class="btn" onclick="editProduct('${p.sku}')">Redaktə</button> <button class="btn danger" onclick="deleteProduct('${p.sku}')">Sil</button></td>
            </tr>`;
        });
        html += `</tbody></table>`;
        $('inventoryTable').innerHTML = html;
    }
    function addOrUpdateProduct() {
        const sku = $('invSku').value.trim();
        const name = $('invName').value.trim();
        const price = Number($('invPrice').value);
        const cost = Number($('invCost').value);
        const qty = Number($('invQty').value);
        
        if (!sku || !name || isNaN(price) || isNaN(cost) || isNaN(qty)) {
            showMessage('inv-alert', 'Bütün xanaları doldurun.');
            return;
        }
        hideMessage('inv-alert');
        
        const products = getJSON(DB.PRODUCTS);
        const existing = products.find(p => p.sku === sku);
        if (existing) {
            existing.name = name;
            existing.price = price;
            existing.cost = cost;
            existing.quantity += qty;
        } else {
            products.push({ sku, name, price, cost, quantity: qty });
        }
        setJSON(DB.PRODUCTS, products);
        renderInventory();
        $('invSku').value = $('invName').value = $('invPrice').value = $('invCost').value = $('invQty').value = '';
    }
    function editProduct(sku) {
        const product = getJSON(DB.PRODUCTS).find(p => p.sku === sku);
        if (product) {
            $('invSku').value = product.sku;
            $('invName').value = product.name;
            $('invPrice').value = product.price;
            $('invCost').value = product.cost;
            $('invQty').value = 0; // Quantity to add, not total
        }
    }
    function deleteProduct(sku) {
        if (confirm('Məhsulu silmək istədiyinizə əminsinizmi?')) {
            const products = getJSON(DB.PRODUCTS).filter(p => p.sku !== sku);
            setJSON(DB.PRODUCTS, products);
            renderInventory();
        }
    }
    $('btnAddInv').addEventListener('click', addOrUpdateProduct);
    $('invSearch').addEventListener('input', renderInventory);

    /* ===== SALES ===== */
    function renderSales() {
        const sales = getJSON(DB.SALES);
        let html = `<table><thead><tr><th>Tarix</th><th>Müştəri FIN</th><th>SKU</th><th>Miqdar</th><th>Qiymət</th><th>Növ</th></tr></thead><tbody>`;
        sales.forEach(s => {
            html += `<tr>
                <td>${s.date}</td>
                <td>${s.fin}</td>
                <td>${s.sku}</td>
                <td>${s.quantity}</td>
                <td>${fmtAZN(s.price)}</td>
                <td>${s.type}</td>
            </tr>`;
        });
        html += `</tbody></table>`;
        $('salesTable').innerHTML = html;
    }
    function makeSale() {
        const fin = $('saleFin').value.trim();
        const sku = $('saleSku').value.trim();
        const qty = Number($('saleQty').value);
        const price = Number($('salePrice').value);
        const type = $('saleType').value;

        if (!fin || !sku || isNaN(qty) || qty <= 0 || isNaN(price) || price <= 0) {
            showMessage('sale-alert', 'Bütün sahələri doldurun.');
            return;
        }

        const products = getJSON(DB.PRODUCTS);
        const product = products.find(p => p.sku === sku);
        if (!product || product.quantity < qty) {
            showMessage('sale-alert', 'Anbarda kifayət qədər məhsul yoxdur.');
            return;
        }
        
        product.quantity -= qty;
        setJSON(DB.PRODUCTS, products);

        const sales = getJSON(DB.SALES);
        sales.push({ date: nowISO(), fin, sku, quantity: qty, price, type });
        setJSON(DB.SALES, sales);

        hideMessage('sale-alert');
        renderSales();
        $('saleFin').value = $('saleSku').value = $('saleQty').value = $('salePrice').value = '';
        alert('Satış uğurla qeydə alındı!');
    }
    $('btnMakeSale').addEventListener('click', makeSale);

    /* ===== CUSTOMERS ===== */
    function renderCustomers() {
        const customers = getJSON(DB.CUSTOMERS);
        const query = ($('searchCustomer').value || '').toLowerCase();
        const filteredCustomers = customers.filter(c => 
            c.name.toLowerCase().includes(query) || 
            c.fin.toLowerCase().includes(query) || 
            c.phone.includes(query)
        );

        let html = `<table><thead><tr><th>Ad Soyad</th><th>FIN Kodu</th><th>Telefon</th><th>Əməliyyat</th></tr></thead><tbody>`;
        filteredCustomers.forEach(c => {
            html += `<tr>
                <td>${c.name}</td>
                <td>${c.fin}</td>
                <td>${c.phone}</td>
                <td><button class="btn" onclick="editCustomer('${c.fin}')">Redaktə</button> <button class="btn danger" onclick="deleteCustomer('${c.fin}')">Sil</button></td>
            </tr>`;
        });
        html += `</tbody></table>`;
        $('customersTable').innerHTML = html;
    }
    function addCustomer() {
        const name = $('custName').value.trim();
        const fin = $('custFin').value.trim();
        const phone = $('custPhone').value.trim();
        if (!name || !fin || !phone) {
            showMessage('customer-alert', 'Bütün xanaları doldurun.');
            return;
        }
        hideMessage('customer-alert');
        const customers = getJSON(DB.CUSTOMERS);
        const existing = customers.find(c => c.fin === fin);
        if (existing) {
            showMessage('customer-alert', 'Bu FIN kodu artıq mövcuddur.');
            return;
        }
        customers.push({ name, fin, phone });
        setJSON(DB.CUSTOMERS, customers);
        renderCustomers();
        $('custName').value = $('custFin').value = $('custPhone').value = '';
        alert('Müştəri əlavə olundu!');
    }
    function editCustomer(fin) {
        const customer = getJSON(DB.CUSTOMERS).find(c => c.fin === fin);
        if (customer) {
            $('custName').value = customer.name;
            $('custFin').value = customer.fin;
            $('custPhone').value = customer.phone;
        }
    }
    function deleteCustomer(fin) {
        if (confirm('Müştərini silmək istədiyinizə əminsinizmi?')) {
            const customers = getJSON(DB.CUSTOMERS).filter(c => c.fin !== fin);
            setJSON(DB.CUSTOMERS, customers);
            renderCustomers();
        }
    }
    $('btnAddCustomer').addEventListener('click', addCustomer);
    $('searchCustomer').addEventListener('input', renderCustomers);

    /* ===== REPORTS ===== */
    function renderReports() {
        hide('reportSummary');
        hide('reportTable');
    }
    function runReport() {
        const fromDate = $('repFrom').value;
        const toDate = $('repTo').value;
        if (!fromDate || !toDate) {
            alert('Tarixləri seçin.');
            return;
        }

        const sales = getJSON(DB.SALES);
        const products = getJSON(DB.PRODUCTS);

        const filteredSales = sales.filter(s => s.date >= fromDate && s.date <= toDate);
        
        let totalRevenue = 0;
        let totalCost = 0;
        let totalProfit = 0;
        
        let html = `<table><thead><tr><th>Tarix</th><th>Müştəri FIN</th><th>SKU</th><th>Qiymət</th><th>Maya</th><th>Mənfəət</th></tr></thead><tbody>`;
        filteredSales.forEach(s => {
            const product = products.find(p => p.sku === s.sku);
            const cost = product ? product.cost * s.quantity : 0;
            const profit = (s.price * s.quantity) - cost;
            
            totalRevenue += s.price * s.quantity;
            totalCost += cost;
            totalProfit += profit;

            html += `<tr>
                <td>${s.date}</td>
                <td>${s.fin}</td>
                <td>${s.sku}</td>
                <td>${fmtAZN(s.price * s.quantity)}</td>
                <td>${fmtAZN(cost)}</td>
                <td>${fmtAZN(profit)}</td>
            </tr>`;
        });
        html += `</tbody></table>`;
        
        $('reportSummary').innerHTML = `
            <div class="row">
                <div class="col-4"><h4 style="margin:0">Ümumi Satış</h4><p style="font-size:1.5rem;font-weight:700;margin:0">${fmtAZN(totalRevenue)}</p></div>
                <div class="col-4"><h4 style="margin:0">Ümumi Maya</h4><p style="font-size:1.5rem;font-weight:700;margin:0">${fmtAZN(totalCost)}</p></div>
                <div class="col-4"><h4 style="margin:0">Ümumi Mənfəət</h4><p style="font-size:1.5rem;font-weight:700;margin:0">${fmtAZN(totalProfit)}</p></div>
            </div>
        `;
        $('reportTable').innerHTML = html;
        show('reportSummary');
        show('reportTable');
    }
    $('btnRunReport').addEventListener('click', runReport);

    /* ===== CALCULATOR ===== */
    function calculate() {
        const price = Number($('calcPrice').value);
        const months = Number($('calcMonths').value);
        
        if (isNaN(price) || price <= 0 || isNaN(months) || months <= 0) {
            showMessage('calc-alert', 'Bütün xanaları düzgün doldurun.');
            return;
        }
        hideMessage('calc-alert');

        const monthlyPayment = price / months;
        $('calcResult').innerHTML = `
            <h4>Hesablamanın nəticəsi</h4>
            <p><strong>Aylıq ödəniş:</strong> ${fmtAZN(monthlyPayment)}</p>
            <p><strong>Cəmi məbləğ:</strong> ${fmtAZN(price)}</p>
            <p><strong>Müddət:</strong> ${months} ay</p>
        `;
        show('calcResult');
    }
    $('btnCalc').addEventListener('click', calculate);

    /* ===== SETTINGS ===== */
    function renderSettings() {
        const settings = getJSON(DB.SETTINGS, { companyName: 'Bakfon Electronics' });
        $('companyName').value = settings.companyName;
    }
    function saveSettings() {
        const companyName = $('companyName').value;
        setJSON(DB.SETTINGS, { companyName });
        alert('Ayarlar yadda saxlandı!');
    }
    $('btnSaveSettings').addEventListener('click', saveSettings);

</script>
</body>
</html>
