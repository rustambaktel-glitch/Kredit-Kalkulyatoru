<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biznes Panel v6.0 - Yekun Versiya</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        :root { --primary-color: #4a90e2; --success-color: #50e3c2; --danger-color: #e35050; --warning-color: #e3b350; --details-color: #904ae2; --text-primary: #e0e0e0; --text-secondary: #b0b0b0; --bg-glass: rgba(22, 28, 49, 0.6); --border-color: rgba(255, 255, 255, 0.1); --bg-dark: #111827; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg-dark); color: var(--text-primary); display: flex; font-size: 14px; overflow: hidden; }
        .sidebar { width: 250px; height: 100vh; position: fixed; background: var(--bg-glass); backdrop-filter: blur(15px); border-right: 1px solid var(--border-color); padding: 20px 0; z-index: 100; }
        .sidebar .logo { text-align: center; padding-bottom: 30px; font-size: 26px; font-weight: 600; letter-spacing: 1px;}
        .sidebar nav ul { list-style: none; }
        .sidebar nav li a { display: flex; align-items: center; gap: 15px; padding: 16px 25px; text-decoration: none; color: var(--text-secondary); font-weight: 500; cursor: pointer; border-left: 4px solid transparent; transition: all 0.3s ease; }
        .sidebar nav li a:hover { background: rgba(74, 144, 226, 0.1); color: var(--text-primary); }
        .sidebar nav li a.active { background: rgba(74, 144, 226, 0.2); color: white; font-weight: 600; border-left: 4px solid var(--primary-color); }
        .sidebar nav li a svg { width: 22px; height: 22px; stroke-width: 2; }
        .main-content { margin-left: 250px; width: calc(100% - 250px); padding: 25px; height: 100vh; overflow-y: auto;}
        header { padding: 15px 30px; background: var(--bg-glass); backdrop-filter: blur(10px); border: 1px solid var(--border-color); border-radius: 12px; margin-bottom: 25px;}
        header h1 { margin: 0; font-size: 24px; font-weight: 600;}
        .page { display: none; } .page.active { display: block; }
        .content-area { background: var(--bg-glass); backdrop-filter: blur(10px); border: 1px solid var(--border-color); padding: 30px; border-radius: 12px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .page-header h2 { font-size: 22px; font-weight: 500;}
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 20px; border: 1px solid transparent; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; text-decoration: none; color: white; transition: all 0.3s ease; }
        .btn svg { width: 18px; height: 18px; }
        .btn-primary { background-color: var(--primary-color); } .btn-primary:hover { background-color: #6a9eda; } .btn-success { background-color: var(--success-color); } .btn-danger { background-color: var(--danger-color); } .btn-warning { background-color: var(--warning-color); }
        .data-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 10px; }
        .data-table th, .data-table td { padding: 15px 20px; text-align: left; }
        .data-table th { color: var(--text-secondary); font-weight: 500; text-transform: uppercase; font-size: 12px; }
        .data-table tbody tr { background: rgba(39, 49, 75, 0.5); border-radius: 8px; }
        .data-table td:first-child { border-top-left-radius: 8px; border-bottom-left-radius: 8px; } .data-table td:last-child { border-top-right-radius: 8px; border-bottom-right-radius: 8px; text-align: right; }
        .actions-cell button { padding: 8px; margin-left: 5px; color: white; border: none; border-radius: 6px; cursor: pointer; display: inline-flex; }
        .btn-edit { background-color: var(--warning-color); } .btn-delete { background-color: var(--danger-color); } .btn-details { background-color: var(--details-color); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
        .modal-content { background: var(--bg-glass); backdrop-filter: blur(15px); border: 1px solid var(--border-color); padding: 35px; border-radius: 12px; width: 600px; position: relative; max-height: 85vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .modal-close { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: var(--text-secondary); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--text-secondary); font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background: rgba(39, 49, 75, 0.7); color: var(--text-primary); font-size: 14px; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.3); }
        .form-actions { text-align: right; margin-top: 30px; }
        .sale-container { display: grid; grid-template-columns: 1.5fr 1fr; gap: 30px; } .sale-summary { background: rgba(39, 49, 75, 0.5); padding: 25px; border-radius: 12px; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 16px; } .summary-row.total { font-weight: bold; font-size: 22px; border-top: 1px solid var(--border-color); padding-top: 15px; margin-top: 15px;} #initialPaymentGroup { display: none; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;}
        .card { background: var(--bg-glass); backdrop-filter: blur(10px); padding: 25px; border-radius: 12px; text-align: center; border: 1px solid var(--border-color);}
        .card h3 { margin: 0 0 10px 0; font-size: 16px; color: var(--text-secondary); font-weight: 500; }
        .card p { margin: 0; font-size: 28px; font-weight: 600; color: white; } .card p.positive { color: var(--success-color); } .card p.negative { color: var(--danger-color); }
        .finance-actions { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 30px; }
        .positive { color: var(--success-color) !important; } .negative { color: var(--danger-color) !important; }
        .sale-type-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;}
        .sale-type-btn { background-color: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); }
        .sale-type-btn.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); font-weight: 600; }
        .search-input { min-width: 250px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">BİZNES PANEL</div>
        <nav id="sidebar-nav"><ul>
            <li><a data-target="finance-page" class="active"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <span>Maliyyə</span></a></li>
            <li><a data-target="reports-page"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0h6m-6-10h6m-6 4h6m0 0v6a2 2 0 002 2h2a2 2 0 002-2v-6a2 2 0 00-2-2h-2a2 2 0 00-2 2z"></path></svg> <span>Hesabatlar</span></a></li>
            <li><a data-target="sales-page"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <span>Satış Etmək</span></a></li>
            <li><a data-target="purchases-page"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg> <span>Mal Alışı</span></a></li>
            <li><a data-target="products-page"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg> <span>Məhsullar</span></a></li>
            <li><a data-target="customers-page"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21v-1a6 6 0 00-1-3.794M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>Müştərilər</span></a></li>
            <li><a data-target="suppliers-page"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg> <span>Təchizatçılar</span></a></li>
        </ul></nav>
    </div>

    <div class="main-content">
        <header><h1 id="page-title">Maliyyə</h1></header>
        <div id="finance-page" class="page active"><div class="content-area"><div class="page-header"><h2>Maliyyə Vəziyyəti</h2><button id="btnBackupData" class="btn btn-primary"><span>Məlumatları Yüklə (Backup)</span></button></div><div class="summary-cards"><div class="card"><h3>Cari Kassa Balansı</h3><p id="current-cash-balance">0.00 ₼</p></div><div class="card"><h3>Müştəri Borcları</h3><p id="total-receivables" class="positive">0.00 ₼</p></div><div class="card"><h3>Təchizatçı Borcları</h3><p id="total-payables" class="negative">0.00 ₼</p></div></div><hr style="margin: 30px 0; border-color: var(--border-color);"><div class="page-header"><h2>Son Əməliyyatlar</h2></div><div class="finance-actions"><button id="btnAcceptPayment" class="btn btn-success"><span>Ödəniş Qəbul Et</span></button><button id="btnAddExpense" class="btn btn-danger"><span>Xərc Əlavə Et</span></button><button id="btnPaySupplier" class="btn btn-warning"><span>Təchizatçıya Ödə</span></button></div><table class="data-table"><thead><tr><th>Tarix</th><th>Növ</th><th>Açıqlama</th><th>Məbləğ</th></tr></thead><tbody id="transactionsTableBody"></tbody></table></div></div>
        <div id="reports-page" class="page"><div class="content-area"><div class="page-header"><h2>Satışların Tarixçəsi</h2><input type="search" id="salesReportSearch" class="form-group search-input" placeholder="Müştəri və ya məbləğə görə axtar..."></div><table class="data-table"><thead><tr><th>#ID</th><th>Tarix</th><th>Müştəri</th><th>Növ</th><th>Yekun Məbləğ</th><th></th></tr></thead><tbody id="salesHistoryTableBody"></tbody></table></div></div>
        <div id="purchases-page" class="page"><form id="purchaseForm"><div class="content-area sale-container"><div><h4>1. Təchizatçı və Məhsul seçimi</h4><div class="form-group"><label>Təchizatçı Seçin</label><select id="purchaseSupplierSelect" required></select></div><div class="form-group"><label>Məhsul Əlavə Et</label><select id="purchaseProductSelect"></select></div><table class="data-table"><thead><tr><th>Məhsul</th><th>Say</th><th>Alış Qiyməti</th><th>Toplam</th><th></th></tr></thead><tbody id="purchaseCartTableBody"></tbody></table></div><div class="sale-summary"><h4>2. Alışı Yekunlaşdır</h4><div class="summary-row total"><span>Yekun Məbləğ:</span><span id="purchaseTotal">0.00 ₼</span></div><div class="form-actions"><button type="submit" class="btn btn-success" style="width: 100%; padding: 15px; font-size: 16px;"><span>Alışı Tamamla</span></button></div></div></div></form></div>
        <div id="sales-page" class="page"><form id="saleForm"><div class="content-area sale-container"><div><h4>1. Müştəri və Məhsul seçimi</h4><div class="form-group"><label for="saleCustomer">Müştəri Seçin</label><select id="saleCustomer" required></select></div><div class="form-group"><label for="saleProduct">Məhsul Əlavə Et</label><select id="saleProduct"></select></div><table class="data-table"><thead><tr><th>Məhsul</th><th>Say</th><th>Qiymət</th><th>Toplam</th><th></th></tr></thead><tbody id="cartTableBody"></tbody></table></div><div class="sale-summary"><h4>2. Satışı Yekunlaşdır</h4><div class="form-group"><label>Satış Növünü Seçin</label><div class="sale-type-buttons"><button type="button" class="btn sale-type-btn active" data-type="Nağd">Nağd</button><button type="button" class="btn sale-type-btn" data-type="POS Terminal">POS</button><button type="button" class="btn sale-type-btn" data-type="Kredit">Kredit</button><button type="button" class="btn sale-type-btn" data-type="Korporativ">Korporativ</button></div></div><div class="form-group" id="initialPaymentGroup"><label for="initialPayment">İlkin Ödəniş (₼)</label><input type="number" id="initialPayment" value="0" step="0.01"></div><hr style="border-color:var(--border-color); margin: 20px 0;"><div class="summary-row"><span>Ümumi Məbləğ:</span><span id="summarySubtotal">0.00 ₼</span></div><div class="summary-row total"><span>Yekun Məbləğ:</span><span id="summaryTotal">0.00 ₼</span></div><div class="form-actions"><button type="submit" class="btn btn-success" style="width: 100%; padding: 15px; font-size: 16px;"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg><span>Satışı Tamamla</span></button></div></div></div></form></div>
        <div id="products-page" class="page"><div class="content-area"><div class="page-header"><h2>Məhsul Siyahısı</h2><input type="search" id="productSearch" class="form-group search-input" placeholder="Məhsul adı və ya ID ilə axtar..."><button id="addProductBtn" class="btn btn-primary"><span>Yeni Məhsul</span></button></div><table class="data-table"><thead><tr><th>#ID</th><th>Ad</th><th>Alış Qiyməti</th><th>Satış Qiyməti</th><th>Anbar Sayı</th><th></th></tr></thead><tbody id="productTableBody"></tbody></table></div></div>
        <div id="customers-page" class="page"><div class="content-area"><div class="page-header"><h2>Müştəri Siyahısı</h2><input type="search" id="customerSearch" class="form-group search-input" placeholder="Ad və ya telefonla axtar..."><button id="addCustomerBtn" class="btn btn-primary"><span>Yeni Müştəri</span></button></div><table class="data-table"><thead><tr><th>#ID</th><th>Tam Adı</th><th>Telefon</th><th>Borc</th><th></th></tr></thead><tbody id="customerTableBody"></tbody></table></div></div>
        <div id="suppliers-page" class="page"><div class="content-area"><div class="page-header"><h2>Təchizatçı Siyahısı</h2><input type="search" id="supplierSearch" class="form-group search-input" placeholder="Ad və ya telefonla axtar..."><button id="addSupplierBtn" class="btn btn-primary"><span>Yeni Təchizatçı</span></button></div><table class="data-table"><thead><tr><th>#ID</th><th>Ad</th><th>Telefon</th><th>Bizim Borcumuz</th><th></th></tr></thead><tbody id="supplierTableBody"></tbody></table></div></div>
    </div>
    
    <div id="addProductModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Yeni Məhsul</h2><form id="addProductForm"><div class="form-group"><label for="productName">Məhsul Adı</label><input type="text" id="productName" required></div><div class="form-group"><label for="purchasePrice">Alış Qiyməti (₼)</label><input type="number" id="purchasePrice" step="0.01" required></div><div class="form-group"><label for="salePrice">Satış Qiyməti (₼)</label><input type="number" id="salePrice" step="0.01" required></div><div class="form-group"><label for="stockQuantity">Anbar Sayı</label><input type="number" id="stockQuantity" required></div><div class="form-actions"><button type="submit" class="btn btn-primary">Yadda Saxla</button></div></form></div></div>
    <div id="editProductModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Məhsulu Redaktə Et</h2><form id="editProductForm"><input type="hidden" id="editProductId"><div class="form-group"><label for="editProductName">Məhsul Adı</label><input type="text" id="editProductName" required></div><div class="form-group"><label for="editPurchasePrice">Alış Qiyməti (₼)</label><input type="number" id="editPurchasePrice" step="0.01" required></div><div class="form-group"><label for="editSalePrice">Satış Qiyməti (₼)</label><input type="number" id="editSalePrice" step="0.01" required></div><div class="form-group"><label for="editStockQuantity">Anbar Sayı</label><input type="number" id="editStockQuantity" required></div><div class="form-actions"><button type="submit" class="btn btn-primary">Dəyişikliyi Saxla</button></div></form></div></div>
    <div id="addCustomerModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Yeni Müştəri</h2><form id="addCustomerForm"><div class="form-group"><label for="customerName">Tam Adı</label><input type="text" id="customerName" required></div><div class="form-group"><label for="customerPhone">Telefon Nömrəsi</label><input type="text" id="customerPhone" required></div><div class="form-actions"><button type="submit" class="btn btn-primary">Yadda Saxla</button></div></form></div></div>
    <div id="editCustomerModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Müştərini Redaktə Et</h2><form id="editCustomerForm"><input type="hidden" id="editCustomerId"><div class="form-group"><label for="editCustomerName">Tam Adı</label><input type="text" id="editCustomerName" required></div><div class="form-group"><label for="editCustomerPhone">Telefon Nömrəsi</label><input type="text" id="editCustomerPhone" required></div><div class="form-actions"><button type="submit" class="btn btn-primary">Dəyişikliyi Saxla</button></div></form></div></div>
    <div id="addSupplierModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Yeni Təchizatçı</h2><form id="addSupplierForm"><div class="form-group"><label>Təchizatçı Adı</label><input type="text" id="supplierName" required></div><div class="form-group"><label>Telefon</label><input type="text" id="supplierPhone"></div><div class="form-actions"><button type="submit" class="btn btn-primary">Yadda Saxla</button></div></form></div></div>
    <div id="editSupplierModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Təchizatçını Redaktə Et</h2><form id="editSupplierForm"><input type="hidden" id="editSupplierId"><div class="form-group"><label>Təchizatçı Adı</label><input type="text" id="editSupplierName" required></div><div class="form-group"><label>Telefon</label><input type="text" id="editSupplierPhone"></div><div class="form-actions"><button type="submit" class="btn btn-primary">Dəyişikliyi Saxla</button></div></form></div></div>
    <div id="saleDetailsModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Satış Detalları</h2><div id="saleDetailsContent" style="margin-top: 20px;"></div></div></div>
    <div id="acceptPaymentModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Müştəri Ödənişi Qəbul Et</h2><form id="acceptPaymentForm"><div class="form-group"><label>Müştəri</label><select id="paymentCustomerSelect" required></select></div><div class="form-group"><label>Ödənilən Məbləğ (₼)</label><input type="number" id="paymentAmount" step="0.01" required></div><div class="form-actions"><button type="submit" class="btn btn-success">Ödənişi Qəbul Et</button></div></form></div></div>
    <div id="addExpenseModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Xərc Əlavə Et</h2><form id="addExpenseForm"><div class="form-group"><label>Xərcin Təsviri</label><textarea id="expenseDescription" rows="3" required></textarea></div><div class="form-group"><label>Məbləğ (₼)</label><input type="number" id="expenseAmount" step="0.01" required></div><div class="form-actions"><button type="submit" class="btn btn-danger">Xərci Əlavə Et</button></div></form></div></div>
    <div id="paySupplierModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Təchizatçıya Ödəniş</h2><form id="paySupplierForm"><div class="form-group"><label>Təchizatçı</label><select id="paymentSupplierSelect" required></select></div><div class="form-group"><label>Ödənilən Məbləğ (₼)</label><input type="number" id="supplierPaymentAmount" step="0.01" required></div><div class="form-actions"><button type="submit" class="btn btn-warning">Ödənişi Et</button></div></form></div></div>
    <div id="purchaseDetailsModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Alış Detalları</h2><div id="purchaseDetailsContent" style="margin-top: 20px;"></div></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- ELEMENT SELECTION (All elements are selected here) ---
        const pageTitle = document.getElementById('page-title'); const sidebarNav = document.getElementById('sidebar-nav'); const pages = document.querySelectorAll('.page'); const allModals = document.querySelectorAll('.modal');
        const addProductModal = document.getElementById('addProductModal'); const editProductModal = document.getElementById('editProductModal'); const addProductBtn = document.getElementById('addProductBtn'); const addProductForm = document.getElementById('addProductForm'); const editProductForm = document.getElementById('editProductForm'); const productTableBody = document.getElementById('productTableBody'); const productSearch = document.getElementById('productSearch');
        const addCustomerModal = document.getElementById('addCustomerModal'); const editCustomerModal = document.getElementById('editCustomerModal'); const addCustomerBtn = document.getElementById('addCustomerBtn'); const addCustomerForm = document.getElementById('addCustomerForm'); const editCustomerForm = document.getElementById('editCustomerForm'); const customerTableBody = document.getElementById('customerTableBody'); const customerSearch = document.getElementById('customerSearch');
        const addSupplierModal = document.getElementById('addSupplierModal'); const editSupplierModal = document.getElementById('editSupplierModal'); const addSupplierBtn = document.getElementById('addSupplierBtn'); const addSupplierForm = document.getElementById('addSupplierForm'); const editSupplierForm = document.getElementById('editSupplierForm'); const supplierTableBody = document.getElementById('supplierTableBody'); const supplierSearch = document.getElementById('supplierSearch');
        const saleForm = document.getElementById('saleForm'); const saleCustomerSelect = document.getElementById('saleCustomer'); const saleProductSelect = document.getElementById('saleProduct'); const cartTableBody = document.getElementById('cartTableBody'); const summarySubtotal = document.getElementById('summarySubtotal'); const summaryTotal = document.getElementById('summaryTotal'); const initialPaymentGroup = document.getElementById('initialPaymentGroup'); const initialPaymentInput = document.getElementById('initialPayment'); let currentCart = [];
        const salesHistoryTableBody = document.getElementById('salesHistoryTableBody'); const saleDetailsModal = document.getElementById('saleDetailsModal'); const totalSalesCount = document.getElementById('total-sales-count'); const totalSalesRevenue = document.getElementById('total-sales-revenue'); const reportsTotalCustomerDebt = document.getElementById('reports-total-customer-debt'); const salesReportSearch = document.getElementById('salesReportSearch');
        const currentCashBalanceEl = document.getElementById('current-cash-balance'); const totalReceivablesEl = document.getElementById('total-receivables'); const totalPayablesEl = document.getElementById('total-payables'); const transactionsTableBody = document.getElementById('transactionsTableBody');
        const btnAcceptPayment = document.getElementById('btnAcceptPayment'); const btnAddExpense = document.getElementById('btnAddExpense'); const btnPaySupplier = document.getElementById('btnPaySupplier'); const btnBackupData = document.getElementById('btnBackupData');
        const acceptPaymentModal = document.getElementById('acceptPaymentModal'); const addExpenseModal = document.getElementById('addExpenseModal'); const paySupplierModal = document.getElementById('paySupplierModal');
        const acceptPaymentForm = document.getElementById('acceptPaymentForm'); const addExpenseForm = document.getElementById('addExpenseForm'); const paySupplierForm = document.getElementById('paySupplierForm');
        const saleTypeButtonsContainer = document.querySelector('.sale-type-buttons'); let selectedSaleType = 'Nağd';
        const purchaseForm = document.getElementById('purchaseForm'); const purchaseSupplierSelect = document.getElementById('purchaseSupplierSelect'); const purchaseProductSelect = document.getElementById('purchaseProductSelect'); const purchaseCartTableBody = document.getElementById('purchaseCartTableBody'); const purchaseTotalEl = document.getElementById('purchaseTotal'); let currentPurchaseCart = [];
        
        // --- CORE FUNCTIONS ---
        const getFromStorage = (key) => JSON.parse(localStorage.getItem(key)) || [];
        const saveToStorage = (key, data) => localStorage.setItem(key, JSON.stringify(data));
        sidebarNav.addEventListener('click', (e) => { const link = e.target.closest('a'); if (link) { e.preventDefault(); const targetPageId = link.getAttribute('data-target'); pages.forEach(p => p.classList.remove('active')); sidebarNav.querySelectorAll('a').forEach(l => l.classList.remove('active')); document.getElementById(targetPageId).classList.add('active'); link.classList.add('active'); pageTitle.textContent = link.querySelector('span').textContent; if (targetPageId === 'sales-page') initializeSalePage(); if(targetPageId === 'purchases-page') initializePurchasePage(); if (targetPageId === 'reports-page') renderReports(); if (targetPageId === 'finance-page') renderFinancePage(); } });
        const openModal = (modal) => modal.style.display = 'flex';
        const closeModal = (modal) => modal.style.display = 'none';
        allModals.forEach(modal => { const closeButton = modal.querySelector('.modal-close'); if(closeButton) closeButton.addEventListener('click', () => closeModal(modal)); window.addEventListener('click', (event) => { if (event.target === modal) closeModal(modal); }); });

        // --- TRANSACTION & BACKUP MODULE ---
        const getTransactions = () => getFromStorage('transactions'); const saveTransactions = (t) => saveToStorage('transactions', t);
        function addTransaction(type, description, amount) { const transactions = getTransactions(); transactions.push({ id: Date.now(), date: new Date().toLocaleString('az-AZ'), type, description, amount }); saveTransactions(transactions); }
        btnBackupData.addEventListener('click', () => {
            const backupData = { products: getProducts(), customers: getCustomers(), suppliers: getSuppliers(), sales: getSales(), purchases: getPurchases(), transactions: getTransactions() };
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `biznes-panel-backup-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
        });

        // --- PRODUCT MODULE ---
        const getProducts = () => getFromStorage('products'); const saveProducts = (p) => saveToStorage('products', p);
        const renderProducts = () => { const query = productSearch.value.toLowerCase(); let products = getProducts(); if (query) { products = products.filter(p => p.name.toLowerCase().includes(query) || p.id.toString().includes(query)); } productTableBody.innerHTML = ''; if (products.length === 0) { productTableBody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Məhsul tapılmadı.</td></tr>'; return; } products.forEach(p => { productTableBody.innerHTML += `<tr><td>${p.id}</td><td>${p.name}</td><td>${p.purchasePrice.toFixed(2)} ₼</td><td>${p.salePrice.toFixed(2)} ₼</td><td>${p.stock} ədəd</td><td class="actions-cell"><button class="btn-edit" data-id="${p.id}">✏️</button><button class="btn-delete" data-id="${p.id}">🗑️</button></td></tr>`; }); };
        addProductBtn.addEventListener('click', () => { addProductForm.reset(); openModal(addProductModal); });
        addProductForm.addEventListener('submit', (e) => { e.preventDefault(); const p = getProducts(); p.push({ id: Date.now(), name: document.getElementById('productName').value, purchasePrice: parseFloat(document.getElementById('purchasePrice').value), salePrice: parseFloat(document.getElementById('salePrice').value), stock: parseInt(document.getElementById('stockQuantity').value) }); saveProducts(p); renderProducts(); closeModal(addProductModal); });
        productTableBody.addEventListener('click', (e) => { const btn = e.target.closest('button'); if (!btn) return; const id = parseInt(btn.dataset.id); if (btn.classList.contains('btn-delete')) { if (confirm('Məhsulu silməyə əminsiniz?')) { saveProducts(getProducts().filter(p => p.id !== id)); renderProducts(); } } if (btn.classList.contains('btn-edit')) { const p = getProducts().find(p => p.id === id); document.getElementById('editProductId').value = p.id; document.getElementById('editProductName').value = p.name; document.getElementById('editPurchasePrice').value = p.purchasePrice; document.getElementById('editSalePrice').value = p.salePrice; document.getElementById('editStockQuantity').value = p.stock; openModal(editProductModal); } });
        editProductForm.addEventListener('submit', (e) => { e.preventDefault(); const id = parseInt(document.getElementById('editProductId').value); const uP = getProducts().map(p => p.id === id ? { id, name: document.getElementById('editProductName').value, purchasePrice: parseFloat(document.getElementById('editPurchasePrice').value), salePrice: parseFloat(document.getElementById('editSalePrice').value), stock: parseInt(document.getElementById('editStockQuantity').value) } : p); saveProducts(uP); renderProducts(); closeModal(editProductModal); });
        productSearch.addEventListener('input', renderProducts);

        // --- CUSTOMER MODULE ---
        const getCustomers = () => getFromStorage('customers'); const saveCustomers = (c) => saveToStorage('customers', c);
        const renderCustomers = () => { const query = customerSearch.value.toLowerCase(); let customers = getCustomers(); if(query){ customers = customers.filter(c => c.name.toLowerCase().includes(query) || c.phone.includes(query)); } customerTableBody.innerHTML = ''; if (customers.length === 0) { customerTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Müştəri tapılmadı.</td></tr>'; return; } customers.forEach(c => { customerTableBody.innerHTML += `<tr><td>${c.id}</td><td>${c.name}</td><td>${c.phone}</td><td>${c.debt.toFixed(2)} ₼</td><td class="actions-cell"><button class="btn-edit" data-id="${c.id}">✏️</button><button class="btn-delete" data-id="${c.id}">🗑️</button></td></tr>`; }); };
        addCustomerBtn.addEventListener('click', () => { addCustomerForm.reset(); openModal(addCustomerModal); });
        addCustomerForm.addEventListener('submit', (e) => { e.preventDefault(); const c = getCustomers(); c.push({ id: Date.now(), name: document.getElementById('customerName').value, phone: document.getElementById('customerPhone').value, debt: 0 }); saveCustomers(c); renderCustomers(); closeModal(addCustomerModal); });
        customerTableBody.addEventListener('click', (e) => { const btn = e.target.closest('button'); if (!btn) return; const id = parseInt(btn.dataset.id); if (btn.classList.contains('btn-delete')) { if (confirm('Müştərini silməyə əminsiniz?')) { saveCustomers(getCustomers().filter(c => c.id !== id)); renderCustomers(); } } if (btn.classList.contains('btn-edit')) { const c = getCustomers().find(c => c.id === id); document.getElementById('editCustomerId').value = c.id; document.getElementById('editCustomerName').value = c.name; document.getElementById('editCustomerPhone').value = c.phone; openModal(editCustomerModal); } });
        editCustomerForm.addEventListener('submit', (e) => { e.preventDefault(); const id = parseInt(document.getElementById('editCustomerId').value); const uC = getCustomers().map(c => c.id === id ? { ...c, name: document.getElementById('editCustomerName').value, phone: document.getElementById('editCustomerPhone').value } : c); saveCustomers(uC); renderCustomers(); closeModal(editCustomerModal); });
        customerSearch.addEventListener('input', renderCustomers);

        // --- SUPPLIER MODULE ---
        const getSuppliers = () => getFromStorage('suppliers'); const saveSuppliers = (s) => saveToStorage('suppliers', s);
        const renderSuppliers = () => { const query = supplierSearch.value.toLowerCase(); let suppliers = getSuppliers(); if(query) { suppliers = suppliers.filter(s => s.name.toLowerCase().includes(query) || s.phone.includes(query)); } supplierTableBody.innerHTML = ''; if (suppliers.length === 0) { supplierTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Təchizatçı tapılmadı.</td></tr>'; return; } suppliers.forEach(s => { supplierTableBody.innerHTML += `<tr><td>${s.id}</td><td>${s.name}</td><td>${s.phone || '-'}</td><td>${(s.balance || 0).toFixed(2)} ₼</td><td class="actions-cell"><button class="btn-edit" data-id="${s.id}">✏️</button><button class="btn-delete" data-id="${s.id}">🗑️</button></td></tr>`; }); };
        addSupplierBtn.addEventListener('click', () => { addSupplierForm.reset(); openModal(addSupplierModal); });
        addSupplierForm.addEventListener('submit', (e) => { e.preventDefault(); const s = getSuppliers(); s.push({ id: Date.now(), name: document.getElementById('supplierName').value, phone: document.getElementById('supplierPhone').value, balance: 0 }); saveSuppliers(s); renderSuppliers(); closeModal(addSupplierModal); });
        supplierTableBody.addEventListener('click', (e) => { const btn = e.target.closest('button'); if (!btn) return; const id = parseInt(btn.dataset.id); if (btn.classList.contains('btn-delete')) { if (confirm('Təchizatçını silməyə əminsiniz?')) { saveSuppliers(getSuppliers().filter(s => s.id !== id)); renderSuppliers(); } } if (btn.classList.contains('btn-edit')) { const s = getSuppliers().find(s => s.id === id); document.getElementById('editSupplierId').value = s.id; document.getElementById('editSupplierName').value = s.name; document.getElementById('editSupplierPhone').value = s.phone; openModal(editSupplierModal); } });
        editSupplierForm.addEventListener('submit', (e) => { e.preventDefault(); const id = parseInt(document.getElementById('editSupplierId').value); const uS = getSuppliers().map(s => s.id === id ? { ...s, name: document.getElementById('editSupplierName').value, phone: document.getElementById('editSupplierPhone').value } : s); saveSuppliers(uS); renderSuppliers(); closeModal(editSupplierModal); });
        supplierSearch.addEventListener('input', renderSuppliers);

        // --- SALES MODULE ---
        const getSales = () => getFromStorage('sales');
        const initializeSalePage = () => { const c = getCustomers(); saleCustomerSelect.innerHTML = '<option value="">-- Müştəri Seçin --</option><option value="0">Nağd Alıcı</option>'; c.forEach(c => { saleCustomerSelect.innerHTML += `<option value="${c.id}">${c.name}</option>`; }); const p = getProducts(); saleProductSelect.innerHTML = '<option value="">-- Məhsul Seçin --</option>'; p.forEach(p => { if (p.stock > 0) { saleProductSelect.innerHTML += `<option value="${p.id}">${p.name} (Stok: ${p.stock})</option>`; }}); currentCart = []; renderCart(); saleForm.reset(); initialPaymentGroup.style.display = 'none'; document.querySelectorAll('.sale-type-btn').forEach(b => b.classList.remove('active')); document.querySelector('.sale-type-btn[data-type="Nağd"]').classList.add('active'); selectedSaleType = 'Nağd'; };
        const renderCart = () => { cartTableBody.innerHTML = ''; let s = 0; if (currentCart.length === 0) { cartTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Səbət boşdur</td></tr>'; } else { currentCart.forEach(i => { const t = i.quantity * i.salePrice; s += t; cartTableBody.innerHTML += `<tr><td>${i.name}</td><td><input type="number" class="cart-quantity-input" data-id="${i.id}" value="${i.quantity}" min="1" max="${i.stock}"></td><td>${i.salePrice.toFixed(2)} ₼</td><td>${t.toFixed(2)} ₼</td><td class="actions-cell"><button type="button" class="btn-delete cart-remove-btn" data-id="${i.id}">🗑️</button></td></tr>`; }); } summarySubtotal.textContent = `${s.toFixed(2)} ₼`; summaryTotal.textContent = `${s.toFixed(2)} ₼`; };
        saleProductSelect.addEventListener('change', () => { const pId = parseInt(saleProductSelect.value); if (!pId) return; const p = getProducts().find(p => p.id === pId); if (!p) return; const eI = currentCart.find(i => i.id === pId); if (eI) { if (eI.quantity < p.stock) { eI.quantity++; } else { alert('Anbarda kifayət qədər məhsul yoxdur!'); } } else { currentCart.push({ ...p, quantity: 1 }); } renderCart(); saleProductSelect.value = ''; });
        cartTableBody.addEventListener('change', (e) => { if (e.target.classList.contains('cart-quantity-input')) { const pId = parseInt(e.target.dataset.id); let nQ = parseInt(e.target.value); const i = currentCart.find(i => i.id === pId); if(!i) return; if (nQ > i.stock) { alert(`Anbarda yalnız ${i.stock} ədəd var!`); nQ = i.stock; e.target.value = nQ; } i.quantity = nQ < 1 ? 1 : nQ; renderCart(); } });
        cartTableBody.addEventListener('click', (e) => { const btn = e.target.closest('button'); if(btn && btn.classList.contains('cart-remove-btn')) { currentCart = currentCart.filter(i => i.id !== parseInt(btn.dataset.id)); renderCart(); }});
        saleTypeButtonsContainer.addEventListener('click', (e) => { const clickedButton = e.target.closest('.sale-type-btn'); if (!clickedButton) return; saleTypeButtonsContainer.querySelectorAll('.sale-type-btn').forEach(btn => btn.classList.remove('active')); clickedButton.classList.add('active'); selectedSaleType = clickedButton.dataset.type; if (selectedSaleType === 'Kredit' || selectedSaleType === 'Korporativ') { initialPaymentGroup.style.display = 'block'; } else { initialPaymentGroup.style.display = 'none'; } });
        saleForm.addEventListener('submit', (e) => { e.preventDefault(); if (currentCart.length === 0 || !saleCustomerSelect.value) { alert('Müştəri seçin və səbətə məhsul əlavə edin!'); return; } const totalAmount = currentCart.reduce((s, i) => s + (i.quantity * i.salePrice), 0); const isCreditType = selectedSaleType === 'Kredit' || selectedSaleType === 'Korporativ'; const customerId = parseInt(saleCustomerSelect.value); const initialPayment = isCreditType ? parseFloat(initialPaymentInput.value) : totalAmount; if (isCreditType && customerId === 0) { alert(`${selectedSaleType} satışı üçün "Nağd Alıcı" seçilə bilməz!`); return; } if (isCreditType && initialPayment >= totalAmount) { alert('İlkin ödəniş ümumi məbləğdən az olmalıdır!'); return; } let products = getProducts(); currentCart.forEach(item => { let product = products.find(p => p.id === item.id); if (product) product.stock -= item.quantity; }); saveProducts(products); if (isCreditType) { let customers = getCustomers(); let customer = customers.find(c => c.id === customerId); if (customer) customer.debt += (totalAmount - initialPayment); saveCustomers(customers); } let sales = getSales(); let customerName = "Nağd Alıcı"; if (customerId !== 0) { const customer = getCustomers().find(c => c.id === customerId); if (customer) customerName = customer.name; else customerName = "Silinmiş Müştəri"; } const newSale = { id: Date.now(), customerId, customerName, items: currentCart, totalAmount, type: selectedSaleType, initialPayment, date: new Date().toLocaleString('az-AZ') }; sales.push(newSale); saveToStorage('sales', sales); addTransaction(`${selectedSaleType} Satış`, `Satış #${newSale.id} - ${newSale.customerName}`, initialPayment); alert('Satış uğurla tamamlandı!'); initializeSalePage(); });

        // --- PURCHASE MODULE ---
        const getPurchases = () => getFromStorage('purchases'); const savePurchases = (p) => saveToStorage('purchases', p);
        const initializePurchasePage = () => { const s = getSuppliers(); purchaseSupplierSelect.innerHTML = '<option value="">-- Təchizatçı Seçin --</option>'; s.forEach(s => { purchaseSupplierSelect.innerHTML += `<option value="${s.id}">${s.name}</option>`; }); const p = getProducts(); purchaseProductSelect.innerHTML = '<option value="">-- Məhsul Seçin --</option>'; p.forEach(p => { purchaseProductSelect.innerHTML += `<option value="${p.id}">${p.name}</option>`; }); currentPurchaseCart = []; renderPurchaseCart(); purchaseForm.reset(); };
        const renderPurchaseCart = () => { purchaseCartTableBody.innerHTML = ''; let total = 0; if (currentPurchaseCart.length === 0) { purchaseCartTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Siyahı boşdur</td></tr>'; } else { currentPurchaseCart.forEach(item => { const itemTotal = item.quantity * item.purchasePrice; total += itemTotal; purchaseCartTableBody.innerHTML += `<tr><td>${item.name}</td><td><input type="number" value="${item.quantity}" class="purchase-quantity-input" data-id="${item.id}" min="1"></td><td><input type="number" value="${item.purchasePrice.toFixed(2)}" class="purchase-price-input" data-id="${item.id}" step="0.01" min="0"></td><td>${itemTotal.toFixed(2)} ₼</td><td class="actions-cell"><button type="button" class="btn-delete purchase-remove-btn" data-id="${item.id}">🗑️</button></td></tr>`; }); } purchaseTotalEl.textContent = `${total.toFixed(2)} ₼`; };
        purchaseProductSelect.addEventListener('change', () => { const pId = parseInt(purchaseProductSelect.value); if(!pId) return; const p = getProducts().find(p => p.id === pId); if(!p) return; const existingItem = currentPurchaseCart.find(i => i.id === pId); if(existingItem) { existingItem.quantity++; } else { currentPurchaseCart.push({ id: p.id, name: p.name, quantity: 1, purchasePrice: p.purchasePrice }); } renderPurchaseCart(); purchaseProductSelect.value = ''; });
        purchaseCartTableBody.addEventListener('input', (e) => { const id = parseInt(e.target.dataset.id); const item = currentPurchaseCart.find(i => i.id === id); if(!item) return; if(e.target.classList.contains('purchase-quantity-input')) { item.quantity = parseInt(e.target.value) || 1; } if(e.target.classList.contains('purchase-price-input')) { item.purchasePrice = parseFloat(e.target.value) || 0; } renderPurchaseCart(); });
        purchaseCartTableBody.addEventListener('click', (e) => { const btn = e.target.closest('button'); if(btn && btn.classList.contains('purchase-remove-btn')) { currentPurchaseCart = currentPurchaseCart.filter(i => i.id !== parseInt(btn.dataset.id)); renderPurchaseCart(); }});
        purchaseForm.addEventListener('submit', (e) => { e.preventDefault(); const supplierId = parseInt(purchaseSupplierSelect.value); if(!supplierId || currentPurchaseCart.length === 0) { alert("Təchizatçı seçin və siyahıya məhsul əlavə edin!"); return; } const totalAmount = currentPurchaseCart.reduce((s, i) => s + (i.quantity * i.purchasePrice), 0); let products = getProducts(); let suppliers = getSuppliers(); const supplier = suppliers.find(s => s.id === supplierId); if(!supplier) return; currentPurchaseCart.forEach(item => { const product = products.find(p => p.id === item.id); if (product) { product.stock += item.quantity; product.purchasePrice = item.purchasePrice; } }); supplier.balance = (supplier.balance || 0) + totalAmount; const newPurchase = { id: Date.now(), supplierId, supplierName: supplier.name, items: currentPurchaseCart, totalAmount, date: new Date().toLocaleString('az-AZ') }; const purchases = getPurchases(); purchases.push(newPurchase); savePurchases(purchases); saveProducts(products); saveSuppliers(suppliers); addTransaction('Mal Alışı', `Alış #${newPurchase.id} - ${supplier.name}`, -totalAmount); alert('Alış uğurla tamamlandı!'); initializePurchasePage(); });

        // --- REPORTS & FINANCE MODULE ---
        const renderReports = () => { const query = salesReportSearch.value.toLowerCase(); let sales = getSales().reverse(); if (query) { sales = sales.filter(s => s.customerName.toLowerCase().includes(query) || s.totalAmount.toString().includes(query)); } const customers = getCustomers(); salesHistoryTableBody.innerHTML = ''; if (sales.length === 0) { salesHistoryTableBody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Satış tapılmadı.</td></tr>'; } else { sales.forEach(sale => { salesHistoryTableBody.innerHTML += `<tr><td>${sale.id}</td><td>${sale.date}</td><td>${sale.customerName}</td><td><span style="background:${sale.type === 'Kredit' || sale.type === 'Korporativ' ? 'var(--warning-color)' : 'var(--success-color)'}; color:white; padding: 4px 10px; border-radius:6px; font-size:12px;">${sale.type}</span></td><td>${sale.totalAmount.toFixed(2)} ₼</td><td class="actions-cell"><button class="btn-details" data-id="${sale.id}">Detallar</button></td></tr>`; }); } totalSalesCount.textContent = sales.length; totalSalesRevenue.textContent = `${sales.reduce((s, sale) => s + sale.totalAmount, 0).toFixed(2)} ₼`; reportsTotalCustomerDebt.textContent = `${customers.reduce((s, c) => s + c.debt, 0).toFixed(2)} ₼`; };
        const renderFinancePage = () => { const t = getTransactions(); const c = getCustomers(); const s = getSuppliers(); const cash = t.reduce((sum, tr) => sum + tr.amount, 0); currentCashBalanceEl.textContent = `${cash.toFixed(2)} ₼`; currentCashBalanceEl.className = cash >= 0 ? 'positive' : 'negative'; totalReceivablesEl.textContent = `${c.reduce((sum, cust) => sum + cust.debt, 0).toFixed(2)} ₼`; totalPayablesEl.textContent = `${s.reduce((sum, sup) => sum + (sup.balance || 0), 0).toFixed(2)} ₼`; transactionsTableBody.innerHTML = ''; t.slice().reverse().forEach(tr => { transactionsTableBody.innerHTML += `<tr><td>${tr.date}</td><td>${tr.type}</td><td>${tr.description}</td><td class="${tr.amount >= 0 ? 'positive' : 'negative'}">${tr.amount.toFixed(2)} ₼</td></tr>`; }); };
        salesHistoryTableBody.addEventListener('click', (e) => { const btn = e.target.closest('button'); if (btn && btn.classList.contains('btn-details')) { const sale = getSales().find(s => s.id === parseInt(btn.dataset.id)); if (!sale) return; let d = `<p><strong>Satış ID:</strong> ${sale.id}</p><p><strong>Müştəri:</strong> ${sale.customerName}</p><p><strong>Yekun Məbləğ:</strong> ${sale.totalAmount.toFixed(2)} ₼</p><hr style="border-color:var(--border-color); margin: 15px 0;"><h4 style="margin-bottom:10px;">Satılan Məhsullar</h4><table class="data-table" style="width:100%;"><thead><tr><th>Məhsul</th><th>Say</th><th>Qiymət</th><th>Toplam</th></tr></thead><tbody>`; sale.items.forEach(i => { d += `<tr><td>${i.name}</td><td>${i.quantity}</td><td>${i.salePrice.toFixed(2)} ₼</td><td>${(i.quantity * i.salePrice).toFixed(2)} ₼</td></tr>`; }); d += '</tbody></table>'; document.getElementById('saleDetailsContent').innerHTML = d; openModal(saleDetailsModal); } });
        btnAcceptPayment.addEventListener('click', () => { const cDebt = getCustomers().filter(c => c.debt > 0); const select = document.getElementById('paymentCustomerSelect'); select.innerHTML = '<option value="">-- Müştəri Seçin --</option>'; cDebt.forEach(c => { select.innerHTML += `<option value="${c.id}">${c.name} (Borc: ${c.debt.toFixed(2)} ₼)</option>`; }); acceptPaymentForm.reset(); openModal(acceptPaymentModal); });
        btnAddExpense.addEventListener('click', () => { addExpenseForm.reset(); openModal(addExpenseModal); });
        btnPaySupplier.addEventListener('click', () => { const sBal = getSuppliers().filter(s => (s.balance || 0) > 0); const select = document.getElementById('paymentSupplierSelect'); select.innerHTML = '<option value="">-- Təchizatçı Seçin --</option>'; sBal.forEach(s => { select.innerHTML += `<option value="${s.id}">${s.name} (Borc: ${s.balance.toFixed(2)} ₼)</option>`; }); paySupplierForm.reset(); openModal(paySupplierModal); });
        acceptPaymentForm.addEventListener('submit', e => { e.preventDefault(); const cId = parseInt(document.getElementById('paymentCustomerSelect').value); if (!cId) { alert("Müştəri seçin."); return; } const amount = parseFloat(document.getElementById('paymentAmount').value); let c = getCustomers(); const cust = c.find(c => c.id === cId); if (!cust || amount > cust.debt || amount <= 0) { alert('Ödəniş məbləği düzgün deyil!'); return; } cust.debt -= amount; saveCustomers(c); addTransaction('Müştəri Ödənişi', `${cust.name} tərəfindən ödəniş`, amount); renderFinancePage(); renderCustomers(); renderReports(); closeModal(acceptPaymentModal); });
        addExpenseForm.addEventListener('submit', e => { e.preventDefault(); const desc = document.getElementById('expenseDescription').value; const amount = parseFloat(document.getElementById('expenseAmount').value); if(amount <= 0) { alert("Məbləğ müsbət olmalıdır."); return; } addTransaction('Xərc', desc, -amount); renderFinancePage(); closeModal(addExpenseModal); });
        paySupplierForm.addEventListener('submit', e => { e.preventDefault(); const sId = parseInt(document.getElementById('paymentSupplierSelect').value); if(!sId){ alert("Təchizatçı seçin."); return; } const amount = parseFloat(document.getElementById('supplierPaymentAmount').value); let s = getSuppliers(); const sup = s.find(s => s.id === sId); if (!sup || amount > sup.balance || amount <= 0) { alert('Ödəniş məbləği düzgün deyil!'); return; } sup.balance -= amount; saveSuppliers(s); addTransaction('Təchizatçıya Ödəniş', `${sup.name} üçün ödəniş`, -amount); renderFinancePage(); renderSuppliers(); closeModal(paySupplierModal); });
        salesReportSearch.addEventListener('input', renderReports);

        // --- INITIAL LOAD ---
        renderProducts(); renderCustomers(); renderSuppliers(); renderReports(); renderFinancePage();
    });
    </script>
</body>
</html>
