<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biznes Panel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap');
        :root {
            --primary-color: #3f51b5;
            --primary-light: #7986cb;
            --primary-dark: #303f9f;
            --success-color: #4caf50;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --text-primary: #212121;
            --text-secondary: #757575;
            --bg-main: #f5f7fa;
            --bg-content: #ffffff;
            --border-color: #e0e0e0;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.1);
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            display: flex;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .sidebar {
            width: 250px;
            height: 100vh;
            position: fixed;
            background: var(--bg-content);
            border-right: 1px solid var(--border-color);
            padding: 2rem 0;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-md);
            z-index: 100;
            transition: transform 0.3s ease-in-out;
        }
        .sidebar .logo {
            text-align: center;
            padding: 0 0 2rem 0;
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-transform: uppercase;
        }
        .sidebar nav {
            flex-grow: 1;
        }
        .sidebar nav ul {
            list-style: none;
            padding: 0 1rem;
        }
        .sidebar nav li a {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
        }
        .sidebar nav li a:hover {
            background: #f0f4f7;
            color: var(--primary-color);
        }
        .sidebar nav li a.active {
            background: var(--primary-color);
            color: #ffffff;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }
        .sidebar nav li a.active svg {
            color: #ffffff;
        }
        .sidebar nav li a svg {
            width: 1.25rem;
            height: 1.25rem;
            stroke-width: 2;
            color: var(--text-secondary);
            transition: color 0.2s ease-in-out;
        }
        .main-content {
            margin-left: 250px;
            width: calc(100% - 250px);
            padding: 2rem;
            transition: margin-left 0.3s ease-in-out;
        }
        .page-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .page-header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 700;
        }
        .search-container {
            position: relative;
        }
        .search-container svg {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1.25rem;
            height: 1.25rem;
            color: var(--text-secondary);
        }
        .search-input {
            min-width: 20rem;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            background: var(--bg-content);
            font-size: 0.875rem;
            transition: all 0.2s ease-in-out;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.2);
        }
        .content-area {
            background: var(--bg-content);
            border: 1px solid var(--border-color);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-sm);
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            text-decoration: none;
            color: white;
            transition: all 0.2s ease-in-out;
            box-shadow: var(--shadow-sm);
        }
        .btn svg {
            width: 1.125rem;
            height: 1.125rem;
        }
        .btn-primary {
            background-color: var(--primary-color);
        }
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        .btn-success {
            background-color: var(--success-color);
        }
        .btn-success:hover {
            background-color: #43a047;
        }
        .btn-danger {
            background-color: var(--danger-color);
        }
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--text-primary);
        }
        .btn-warning:hover {
            background-color: #fb8c00;
        }
        .actions-cell {
            text-align: right;
            white-space: nowrap;
        }
        .actions-cell button {
            padding: 0.5rem;
            margin-left: 0.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            display: inline-flex;
            background: transparent;
            transition: background-color 0.2s;
        }
        .actions-cell button:hover {
            background-color: #f0f4f7;
        }
        .btn-edit {
            color: var(--warning-color);
        }
        .btn-delete {
            color: var(--danger-color);
        }
        .btn-details {
            color: var(--primary-color);
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0;
        }
        .data-table th,
        .data-table td {
            padding: 1rem 1.5rem;
            text-align: left;
            border: 1px solid var(--border-color);
        }
        .data-table th {
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            background-color: #f9fafb;
        }
        .data-table tbody tr {
            background: #ffffff;
            transition: background-color 0.2s;
        }
        .data-table tbody tr:hover {
            background-color: #f0f4f7;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(33, 33, 33, 0.6);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: var(--bg-content);
            padding: 2.5rem;
            border-radius: 1rem;
            width: 45rem;
            max-width: 90%;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-md);
            animation: modal-open 0.3s ease-out;
        }
        @keyframes modal-open {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 2rem;
            cursor: pointer;
            color: #bdbdbd;
            transition: color 0.2s;
        }
        .modal-close:hover {
            color: var(--text-primary);
        }
        .form-group {
            margin-bottom: 1.25rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.875rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            background: var(--bg-main);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.2s ease-in-out;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.2);
        }
        .form-actions {
            text-align: right;
            margin-top: 2rem;
        }
        .sale-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(12rem, 1fr));
            gap: 1.5rem;
        }
        .card {
            background: var(--bg-content);
            padding: 1.5rem;
            border-radius: 1rem;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }
        .card h3 {
            margin: 0 0 0.5rem 0;
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        .card p {
            font-family: 'Poppins', sans-serif;
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        .positive {
            color: var(--success-color) !important;
        }
        .negative {
            color: var(--danger-color) !important;
        }
        .report-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .report-actions .btn {
            background-color: #f0f4f7;
            color: var(--text-secondary);
            box-shadow: none;
        }
        .report-actions .btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .sale-type-buttons button {
            background-color: #e9ecef;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            flex: 1;
        }
        .sale-type-buttons button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 1rem;
            color: var(--text-primary);
        }
        .summary-row.total {
            font-weight: 700;
            font-size: 1.5rem;
            margin-top: 1.5rem;
            border-bottom: none;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                box-shadow: none;
                padding: 1rem;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            .sidebar .logo {
                display: none;
            }
            .sidebar nav ul {
                display: flex;
                justify-content: space-around;
                flex-wrap: wrap;
                padding: 0;
            }
            .sidebar nav li a {
                margin: 0.25rem;
                flex-direction: column;
                gap: 0.25rem;
                padding: 0.5rem;
            }
            .sidebar nav li a span {
                font-size: 0.75rem;
            }
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 1rem;
            }
            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .search-input {
                min-width: 100%;
            }
            .sale-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">Bƒ∞ZNES PANEL</div>
        <nav id="sidebar-nav">
            <ul>
                <li><a data-page="finance" class="active"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <span>Maliyy…ô</span></a></li>
                <li><a data-page="reports"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0h6m-6-10h6m-6 4h6m0 0v6a2 2 0 002 2h2a2 2 0 002-2v-6a2 2 0 00-2-2h-2a2 2 0 00-2 2z"></path></svg> <span>Hesabatlar</span></a></li>
                <li><a data-page="sales"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <span>Satƒ±≈ü Etm…ôk</span></a></li>
                <li><a data-page="purchases"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg> <span>Mal Alƒ±≈üƒ±</span></a></li>
                <li><a data-page="products"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg> <span>M…ôhsullar</span></a></li>
                <li><a data-page="customers"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21v-1a6 6 0 00-1-3.794M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>M√º≈üt…ôril…ôr</span></a></li>
                <li><a data-page="suppliers"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg> <span>T…ôchizat√ßƒ±lar</span></a></li>
            </ul>
        </nav>
    </div>

    <main class="main-content" id="app-container">
    </main>

    <div id="addProductModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Yeni M…ôhsul</h2><form id="addProductForm"><div class="form-group"><label for="productNameModal">M…ôhsul Adƒ±</label><input type="text" id="productNameModal" required></div><div class="form-group"><label for="purchasePriceModal">Alƒ±≈ü Qiym…ôti (‚Çº)</label><input type="number" id="purchasePriceModal" step="0.01" required></div><div class="form-group"><label for="salePriceModal">Satƒ±≈ü Qiym…ôti (‚Çº)</label><input type="number" id="salePriceModal" step="0.01" required></div><div class="form-group"><label for="stockQuantityModal">Anbar Sayƒ±</label><input type="number" id="stockQuantityModal" required></div><div class="form-actions"><button type="submit" class="btn btn-primary">Yadda Saxla</button></div></form></div></div>
    <div id="editProductModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>M…ôhsulu Redakt…ô Et</h2><form id="editProductForm"><input type="hidden" id="editProductId"><div class="form-group"><label for="editProductName">M…ôhsul Adƒ±</label><input type="text" id="editProductName" required></div><div class="form-group"><label for="editPurchasePrice">Alƒ±≈ü Qiym…ôti (‚Çº)</label><input type="number" id="editPurchasePrice" step="0.01" required></div><div class="form-group"><label for="editSalePrice">Satƒ±≈ü Qiym…ôti (‚Çº)</label><input type="number" id="editSalePrice" step="0.01" required></div><div class="form-group"><label for="editStockQuantity">Anbar Sayƒ±</label><input type="number" id="editStockQuantity" required></div><div class="form-actions"><button type="submit" class="btn btn-primary">D…ôyi≈üikliyi Saxla</button></div></form></div></div>
    <div id="addCustomerModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Yeni M√º≈üt…ôri</h2><form id="addCustomerForm"><div class="form-group"><label for="customerNameModal">Tam Adƒ±</label><input type="text" id="customerNameModal" required></div><div class="form-group"><label for="customerPhoneModal">Telefon N√∂mr…ôsi</label><input type="text" id="customerPhoneModal" required></div><div class="form-actions"><button type="submit" class="btn btn-primary">Yadda Saxla</button></div></form></div></div>
    <div id="editCustomerModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>M√º≈üt…ôrini Redakt…ô Et</h2><form id="editCustomerForm"><input type="hidden" id="editCustomerId"><div class="form-group"><label for="editCustomerName">Tam Adƒ±</label><input type="text" id="editCustomerName" required></div><div class="form-group"><label for="editCustomerPhone">Telefon N√∂mr…ôsi</label><input type="text" id="editCustomerPhone" required></div><div class="form-actions"><button type="submit" class="btn btn-primary">D…ôyi≈üikliyi Saxla</button></div></form></div></div>
    <div id="addSupplierModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Yeni T…ôchizat√ßƒ±</h2><form id="addSupplierForm"><div class="form-group"><label for="supplierNameModal">T…ôchizat√ßƒ± Adƒ±</label><input type="text" id="supplierNameModal" required></div><div class="form-group"><label for="supplierPhoneModal">Telefon</label><input type="text" id="supplierPhoneModal"></div><div class="form-actions"><button type="submit" class="btn btn-primary">Yadda Saxla</button></div></form></div></div>
    <div id="editSupplierModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>T…ôchizat√ßƒ±nƒ± Redakt…ô Et</h2><form id="editSupplierForm"><input type="hidden" id="editSupplierId"><div class="form-group"><label for="editSupplierName">T…ôchizat√ßƒ± Adƒ±</label><input type="text" id="editSupplierName" required></div><div class="form-group"><label for="editSupplierPhone">Telefon</label><input type="text" id="editSupplierPhone"></div><div class="form-actions"><button type="submit" class="btn btn-primary">D…ôyi≈üikliyi Saxla</button></div></form></div></div>
    <div id="saleDetailsModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Satƒ±≈ü Detallarƒ±</h2><div id="saleDetailsContent" style="margin-top: 20px;"></div></div></div>
    <div id="acceptPaymentModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>M√º≈üt…ôri √ñd…ôni≈üi Q…ôbul Et</h2><form id="acceptPaymentForm"><div class="form-group"><label>M√º≈üt…ôri</label><select id="paymentCustomerSelect" required></select></div><div class="form-group"><label>√ñd…ônil…ôn M…ôbl…ôƒü (‚Çº)</label><input type="number" id="paymentAmount" step="0.01" required></div><div class="form-actions"><button type="submit" class="btn btn-success">√ñd…ôni≈üi Q…ôbul Et</button></div></form></div></div>
    <div id="addExpenseModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>X…ôrc ∆èlav…ô Et</h2><form id="addExpenseForm"><div class="form-group"><label>X…ôrcin T…ôsviri</label><textarea id="expenseDescription" rows="3" required></textarea></div><div class="form-group"><label>M…ôbl…ôƒü (‚Çº)</label><input type="number" id="expenseAmount" step="0.01" required></div><div class="form-actions"><button type="submit" class="btn btn-danger">X…ôrci ∆èlav…ô Et</button></div></form></div></div>
    <div id="paySupplierModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>T…ôchizat√ßƒ±ya √ñd…ôni≈ü</h2><form id="paySupplierForm"><div class="form-group"><label>T…ôchizat√ßƒ±</label><select id="paymentSupplierSelect" required></select></div><div class="form-group"><label>√ñd…ônil…ôn M…ôbl…ôƒü (‚Çº)</label><input type="number" id="supplierPaymentAmount" step="0.01" required></div><div class="form-actions"><button type="submit" class="btn btn-warning">√ñd…ôni≈üi Et</button></div></form></div></div>
    <div id="customerSalesHistoryModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2 id="customer-history-title">M√º≈üt…ôri Satƒ±≈ü Tarix√ß…ôsi</h2><div id="customerSalesHistoryContent" style="margin-top: 20px;"></div></div></div>
    <div id="purchaseDetailsModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Alƒ±≈ü Detallarƒ±</h2><div id="purchaseDetailsContent" style="margin-top: 20px;"></div></div></div>
    <div id="productsInSaleModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h2>Satƒ±≈üdakƒ± M…ôhsullar</h2><div id="productsInSaleContent"></div></div></div>

    <template id="finance-page-template"><div class="page-container"><div class="page-header"><h1>Maliyy…ô</h1><button id="btnBackupData" class="btn btn-primary"><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg> M…ôlumatlarƒ± Y√ºkl…ô (Backup)</span></button></div><div class="summary-cards"><div class="card"><h3>Cari Kassa Balansƒ±</h3><p id="current-cash-balance">0.00 ‚Çº</p></div><div class="card"><h3>M√º≈üt…ôri Borclarƒ±</h3><p id="total-receivables" class="positive">0.00 ‚Çº</p></div><div class="card"><h3>T…ôchizat√ßƒ± Borclarƒ±</h3><p id="total-payables" class="negative">0.00 ‚Çº</p></div></div><div class="content-area"><div class="page-header" style="margin-bottom: 1rem; padding: 0;"><h2>Son ∆èm…ôliyyatlar</h2><div class="finance-actions" style="display: flex; gap: 0.5rem;"><button id="btnAcceptPayment" class="btn btn-success"><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8V6m0 4v4m0 4v2m-6-2h12a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg> √ñd…ôni≈ü Q…ôbul Et</span></button><button id="btnAddExpense" class="btn btn-danger"><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> X…ôrc ∆èlav…ô Et</span></button><button id="btnPaySupplier" class="btn btn-warning"><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 21h10a2 2 0 002-2V8a2 2 0 00-2-2H7a2 2 0 00-2 2v11a2 2 0 002 2z"></path></svg> T…ôchizat√ßƒ±ya √ñd…ô</span></button></div></div><table class="data-table"><thead><tr><th>Tarix</th><th>N√∂v</th><th>A√ßƒ±qlama</th><th>M…ôbl…ôƒü</th></tr></thead><tbody id="transactionsTableBody"></tbody></table></div></div></template>
    <template id="reports-page-template"><div class="page-container"><div class="page-header"><h1>Hesabatlar</h1></div><div class="content-area"><div class="report-actions" id="report-tabs"><button class="btn btn-primary active" data-report="sales">Satƒ±≈ülar</button><button class="btn btn-primary" data-report="purchases">Alƒ±≈ülar</button><button class="btn btn-primary" data-report="financial">Maliyy…ô</button></div><div id="sales-report-view" class="report-view"><div class="page-header" style="padding: 1rem 0 0 0;"><div class="search-container"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><input type="search" id="salesReportSearch" class="search-input" placeholder="M√º≈üt…ôri v…ô ya m…ôbl…ôƒü…ô g√∂r…ô axtar..."></div></div><table class="data-table"><thead><tr><th>#ID</th><th>Tarix</th><th>M√º≈üt…ôri</th><th>N√∂v</th><th>Yekun M…ôbl…ôƒü</th><th></th></tr></thead><tbody id="salesHistoryTableBody"></tbody></table></div><div id="purchases-report-view" class="report-view" style="display:none;"><div class="page-header" style="padding: 1rem 0 0 0;"><div class="search-container"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><input type="search" id="purchasesReportSearch" class="search-input" placeholder="T…ôchizat√ßƒ± v…ô ya m…ôbl…ôƒü…ô g√∂r…ô axtar..."></div></div><table class="data-table"><thead><tr><th>#ID</th><th>Tarix</th><th>T…ôchizat√ßƒ±</th><th>Yekun M…ôbl…ôƒü</th><th></th></tr></thead><tbody id="purchasesHistoryTableBody"></tbody></table></div><div id="financial-report-view" class="report-view" style="display:none;"><div class="page-header" style="padding: 1rem 0 0 0;"><div class="search-container"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><input type="search" id="financialReportSearch" class="search-input" placeholder="N√∂v v…ô ya a√ßƒ±qlamaya g√∂r…ô axtar..."></div></div><table class="data-table"><thead><tr><th>#ID</th><th>Tarix</th><th>N√∂v</th><th>A√ßƒ±qlama</th><th>M…ôbl…ôƒü</th></tr></thead><tbody id="financialHistoryTableBody"></tbody></table></div></div></div></template>
    <template id="sales-page-template"><div class="page-container"><div class="page-header"><h1>Satƒ±≈ü Etm…ôk</h1></div><form id="saleForm"><div class="sale-container"><div class="content-area"><h4>M√º≈üt…ôri v…ô M…ôhsul se√ßimi</h4><div class="form-group"><label for="saleCustomer">M√º≈üt…ôri Se√ßin</label><select id="saleCustomer" required></select></div><div class="form-group"><label for="saleProduct">M…ôhsul ∆èlav…ô Et</label><select id="saleProduct"></select></div><table class="data-table"><thead><tr><th>M…ôhsul</th><th>Say</th><th>Qiym…ôt</th><th>Toplam</th><th></th></tr></thead><tbody id="cartTableBody"></tbody></table></div><div class="content-area"><h4>Satƒ±≈üƒ± Yekunla≈üdƒ±r</h4><div class="form-group"><label>Satƒ±≈ü N√∂v√ºn√º Se√ßin</label><div class="sale-type-buttons" style="display:flex; gap: 0.5rem;"><button type="button" class="btn sale-type-btn active" data-type="Naƒüd">Naƒüd</button><button type="button" class="btn sale-type-btn" data-type="POS Terminal">POS</button><button type="button" class="btn sale-type-btn" data-type="Kredit">Kredit</button><button type="button" class="btn sale-type-btn" data-type="Korporativ">Korporativ</button></div></div><div class="form-group" id="initialPaymentGroup" style="display:none;"><label for="initialPayment">ƒ∞lkin √ñd…ôni≈ü (‚Çº)</label><input type="number" id="initialPayment" value="0" step="0.01"></div><div class="summary-row"><span>Yekun M…ôbl…ôƒü:</span><span id="summaryTotal">0.00 ‚Çº</span></div><div class="summary-row" id="debt-row" style="display:none;"><span>Borc qalƒ±ƒüƒ±:</span><span id="debt-total">0.00 ‚Çº</span></div><div class="form-actions"><button type="submit" class="btn btn-success" style="width: 100%; padding: 1rem; font-size: 1rem;"><span>Satƒ±≈üƒ± Tamamla</span></button></div></div></div></form></div></template>
    <template id="purchases-page-template"><div class="page-container"><div class="page-header"><h1>Yeni Mal Alƒ±≈üƒ±</h1></div><form id="purchaseForm"><div class="sale-container"><div class="content-area"><h4>T…ôchizat√ßƒ± v…ô M…ôhsul se√ßimi</h4><div class="form-group"><label>T…ôchizat√ßƒ± Se√ßin</label><select id="purchaseSupplierSelect" required></select></div><div class="form-group"><label>M…ôhsul ∆èlav…ô Et</label><select id="purchaseProductSelect"></select></div><table class="data-table"><thead><tr><th>M…ôhsul</th><th>Say</th><th>Alƒ±≈ü Qiym…ôti</th><th>Toplam</th><th></th></tr></thead><tbody id="purchaseCartTableBody"></tbody></table></div><div class="content-area"><h4>Alƒ±≈üƒ± Yekunla≈üdƒ±r</h4><div class="summary-row total" style="margin-top: 1.5rem;"><span>Yekun M…ôbl…ôƒü:</span><span id="purchaseTotal">0.00 ‚Çº</span></div><div class="form-actions"><button type="submit" class="btn btn-success" style="width: 100%; padding: 1rem; font-size: 1rem;"><span>Alƒ±≈üƒ± Tamamla</span></button></div></div></div></form></div></template>
    <template id="products-page-template"><div class="page-container"><div class="page-header"><h1>M…ôhsullar</h1><div class="search-container"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><input type="search" id="productSearch" class="search-input" placeholder="M…ôhsul adƒ± v…ô ya ID il…ô axtar..."></div><button id="addProductBtn" class="btn btn-primary"><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg> Yeni M…ôhsul</span></button></div><div class="content-area"><table class="data-table"><thead><tr><th>#ID</th><th>Ad</th><th>Alƒ±≈ü Qiym…ôti</th><th>Satƒ±≈ü Qiym…ôti</th><th>Anbar Sayƒ±</th><th></th></tr></thead><tbody id="productTableBody"></tbody></table></div></div></template>
    <template id="customers-page-template"><div class="page-container"><div class="page-header"><h1>M√º≈üt…ôril…ôr</h1><div class="search-container"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><input type="search" id="customerSearch" class="search-input" placeholder="Ad v…ô ya telefonla axtar..."></div><button id="addCustomerBtn" class="btn btn-primary"><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg> Yeni M√º≈üt…ôri</span></button></div><div class="content-area"><table class="data-table"><thead><tr><th>#ID</th><th>Tam Adƒ±</th><th>Telefon</th><th>Borc</th><th></th></tr></thead><tbody id="customerTableBody"></tbody></table></div></div></template>
    <template id="suppliers-page-template"><div class="page-container"><div class="page-header"><h1>T…ôchizat√ßƒ±lar</h1><div class="search-container"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><input type="search" id="supplierSearch" class="search-input" placeholder="Ad v…ô ya telefonla axtar..."></div><button id="addSupplierBtn" class="btn btn-primary"><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg> Yeni T…ôchizat√ßƒ±</span></button></div><div class="content-area"><table class="data-table"><thead><tr><th>#ID</th><th>Ad</th><th>Telefon</th><th>Bizim Borcumuz</th><th></th></tr></thead><tbody id="supplierTableBody"></tbody></table></div></div></template>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const appContainer = document.getElementById('app-container');
        const sidebarNav = document.getElementById('sidebar-nav');
        const allModals = document.querySelectorAll('.modal');

        const getFromStorage = (key) => JSON.parse(localStorage.getItem(key)) || [];
        const saveToStorage = (key, data) => localStorage.setItem(key, JSON.stringify(data));
        
        const openModal = (modal) => {
            modal.style.display = 'flex';
            modal.style.zIndex = '1000';
            modal.style.position = 'fixed';
            modal.style.animation = 'modal-open 0.3s ease-out';
        };

        const closeModal = (modal) => {
            modal.style.display = 'none';
        };

        allModals.forEach(modal => {
            const closeButton = modal.querySelector('.modal-close');
            if(closeButton) closeButton.addEventListener('click', () => closeModal(modal));
            window.addEventListener('click', (event) => { if (event.target === modal) closeModal(modal); });
        });
        
        const pageSetups = {
            'finance': setupFinancePage, 'reports': setupReportsPage, 'sales': setupSalesPage,
            'purchases': setupPurchasesPage, 'products': setupProductsPage, 'customers': setupCustomersPage, 'suppliers': setupSuppliersPage
        };

        const renderPage = (pageName) => {
            const template = document.getElementById(`${pageName}-page-template`);
            if (!template) { console.error(`Template for page "${pageName}" not found.`); return; }
            appContainer.innerHTML = '';
            const pageContent = template.content.cloneNode(true);
            appContainer.appendChild(pageContent);
            if (pageSetups[pageName]) pageSetups[pageName]();
        };

        sidebarNav.addEventListener('click', (e) => {
            const link = e.target.closest('a');
            if (link) {
                e.preventDefault();
                const pageName = link.dataset.page;
                if(pageName) {
                    sidebarNav.querySelectorAll('a').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    renderPage(pageName);
                }
            }
        });

        const getProducts = () => getFromStorage('products'); const saveProducts = (p) => saveToStorage('products', p);
        const getCustomers = () => getFromStorage('customers'); const saveCustomers = (c) => saveToStorage('customers', c);
        const getSuppliers = () => getFromStorage('suppliers'); const saveSuppliers = (s) => saveToStorage('suppliers', s);
        const getSales = () => getFromStorage('sales'); const saveSales = (s) => saveToStorage('sales', s);
        const getPurchases = () => getFromStorage('purchases'); const savePurchases = (p) => saveToStorage('purchases', p);
        const getTransactions = () => getFromStorage('transactions'); const saveTransactions = (t) => saveToStorage('transactions', t);
        
        function addTransaction(type, description, amount) {
            const transactions = getTransactions();
            transactions.push({ id: Date.now(), date: new Date().toLocaleString('az-AZ'), type, description, amount });
            saveTransactions(transactions);
        }

        function setupProductsPage() {
            const productTableBody = appContainer.querySelector('#productTableBody');
            const addProductBtn = appContainer.querySelector('#addProductBtn');
            const productSearch = appContainer.querySelector('#productSearch');
            const addProductModal = document.getElementById('addProductModal');
            const editProductModal = document.getElementById('editProductModal');
            const addProductForm = document.getElementById('addProductForm');
            const editProductForm = document.getElementById('editProductForm');

            const renderProducts = () => {
                const query = productSearch.value.toLowerCase();
                let products = getProducts();
                if (query) {
                    products = products.filter(p => p.name.toLowerCase().includes(query) || p.id.toString().includes(query));
                }
                productTableBody.innerHTML = '';
                if (products.length === 0) {
                    productTableBody.innerHTML = '<tr><td colspan="6" style="text-align:center;">M…ôhsul tapƒ±lmadƒ±.</td></tr>';
                    return;
                }
                products.forEach(p => {
                    productTableBody.innerHTML += `<tr><td>${p.id}</td><td>${p.name}</td><td>${p.purchasePrice.toFixed(2)} ‚Çº</td><td>${p.salePrice.toFixed(2)} ‚Çº</td><td>${p.stock} …ôd…ôd</td><td class="actions-cell"><button class="btn-edit" data-id="${p.id}">‚úèÔ∏è</button><button class="btn-delete" data-id="${p.id}">üóëÔ∏è</button></td></tr>`;
                });
            };

            addProductBtn.addEventListener('click', () => { addProductForm.reset(); openModal(addProductModal); });
            addProductForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const products = getProducts();
                const newProduct = {
                    id: Date.now(),
                    name: document.getElementById('productNameModal').value,
                    purchasePrice: parseFloat(document.getElementById('purchasePriceModal').value),
                    salePrice: parseFloat(document.getElementById('salePriceModal').value),
                    stock: parseInt(document.getElementById('stockQuantityModal').value)
                };
                products.push(newProduct);
                saveProducts(products);
                renderProducts();
                closeModal(addProductModal);
            });

            productTableBody.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if (!btn) return;
                const id = parseInt(btn.dataset.id);

                if (btn.classList.contains('btn-delete')) {
                    if (confirm('M…ôhsulu silm…ôy…ô …ôminsiniz?')) {
                        saveProducts(getProducts().filter(p => p.id !== id));
                        renderProducts();
                    }
                }
                if (btn.classList.contains('btn-edit')) {
                    const product = getProducts().find(p => p.id === id);
                    if (product) {
                        document.getElementById('editProductId').value = product.id;
                        document.getElementById('editProductName').value = product.name;
                        document.getElementById('editPurchasePrice').value = product.purchasePrice;
                        document.getElementById('editSalePrice').value = product.salePrice;
                        document.getElementById('editStockQuantity').value = product.stock;
                        openModal(editProductModal);
                    }
                }
            });

            editProductForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = parseInt(document.getElementById('editProductId').value);
                const updatedProducts = getProducts().map(p => p.id === id ? {
                    id,
                    name: document.getElementById('editProductName').value,
                    purchasePrice: parseFloat(document.getElementById('editPurchasePrice').value),
                    salePrice: parseFloat(document.getElementById('editSalePrice').value),
                    stock: parseInt(document.getElementById('editStockQuantity').value)
                } : p);
                saveProducts(updatedProducts);
                renderProducts();
                closeModal(editProductModal);
            });

            productSearch.addEventListener('input', renderProducts);
            renderProducts();
        }

        function setupCustomersPage() {
            const customerTableBody = appContainer.querySelector('#customerTableBody');
            const addCustomerBtn = appContainer.querySelector('#addCustomerBtn');
            const customerSearch = appContainer.querySelector('#customerSearch');
            const addCustomerModal = document.getElementById('addCustomerModal');
            const editCustomerModal = document.getElementById('editCustomerModal');
            const addCustomerForm = document.getElementById('addCustomerForm');
            const editCustomerForm = document.getElementById('editCustomerForm');
            const customerSalesHistoryModal = document.getElementById('customerSalesHistoryModal');
            const saleDetailsModal = document.getElementById('saleDetailsModal');

            const renderCustomers = () => {
                const query = customerSearch.value.toLowerCase();
                let customers = getCustomers();
                if(query){
                    customers = customers.filter(c => c.name.toLowerCase().includes(query) || c.phone.includes(query));
                }
                customerTableBody.innerHTML = '';
                if (customers.length === 0) {
                    customerTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">M√º≈üt…ôri tapƒ±lmadƒ±.</td></tr>';
                    return;
                }
                customers.forEach(c => {
                    customerTableBody.innerHTML += `<tr><td>${c.id}</td><td>${c.name}</td><td>${c.phone}</td><td>${c.debt.toFixed(2)} ‚Çº</td><td class="actions-cell"><button class="btn-details customer-details-btn" data-id="${c.id}">Detallar</button><button class="btn-edit" data-id="${c.id}">‚úèÔ∏è</button><button class="btn-delete" data-id="${c.id}">üóëÔ∏è</button></td></tr>`;
                });
            };
            
            const addCustomerFormSubmitHandler = (e) => {
                e.preventDefault();
                const customers = getCustomers();
                customers.push({
                    id: Date.now(),
                    name: document.getElementById('customerNameModal').value,
                    phone: document.getElementById('customerPhoneModal').value,
                    debt: 0
                });
                saveCustomers(customers);
                renderCustomers();
                closeModal(addCustomerModal);
            };

            addCustomerBtn.addEventListener('click', () => { addCustomerForm.reset(); openModal(addCustomerModal); });
            addCustomerForm.addEventListener('submit', addCustomerFormSubmitHandler);

            customerTableBody.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if (!btn) return;
                const id = parseInt(btn.dataset.id);

                if (btn.classList.contains('customer-details-btn')) {
                    const sales = getSales().filter(s => s.customerId === id);
                    const customer = getCustomers().find(c => c.id === id);
                    
                    const historyTitle = document.getElementById('customer-history-title');
                    const historyContent = document.getElementById('customerSalesHistoryContent');

                    historyTitle.textContent = `${customer.name} - Satƒ±≈ü Tarix√ß…ôsi`;
                    let historyHtml = `<table class="data-table"><thead><tr><th>#ID</th><th>Tarix</th><th>N√∂v</th><th>M…ôbl…ôƒü</th><th></th></tr></thead><tbody>`;
                    
                    sales.reverse().forEach(sale => {
                        historyHtml += `<tr>
                            <td>${sale.id}</td>
                            <td>${sale.date}</td>
                            <td>${sale.type}</td>
                            <td>${sale.totalAmount.toFixed(2)} ‚Çº</td>
                            <td class="actions-cell"><button class="btn-details view-sale-details-from-customer" data-id="${sale.id}">M…ôhsullar</button></td>
                        </tr>`;
                    });
                    historyHtml += `</tbody></table>`;
                    historyContent.innerHTML = historyHtml;
                    
                    openModal(customerSalesHistoryModal);
                    return;
                }

                if (btn.classList.contains('btn-delete')) {
                    const customer = getCustomers().find(c => c.id === id);
                    if (customer.debt > 0) {
                        alert('Bu m√º≈üt…ôrinin borcu olduƒüu √º√ß√ºn silin…ô bilm…ôz!');
                        return;
                    }
                    if (confirm('M√º≈üt…ôrini silm…ôy…ô …ôminsiniz?')) {
                        saveCustomers(getCustomers().filter(c => c.id !== id));
                        renderCustomers();
                    }
                }
                if (btn.classList.contains('btn-edit')) {
                    const customer = getCustomers().find(c => c.id === id);
                    if (customer) {
                        document.getElementById('editCustomerId').value = customer.id;
                        document.getElementById('editCustomerName').value = customer.name;
                        document.getElementById('editCustomerPhone').value = customer.phone;
                        openModal(editCustomerModal);
                    }
                }
            });

            editCustomerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = parseInt(document.getElementById('editCustomerId').value);
                const updatedCustomers = getCustomers().map(c => c.id === id ? {
                    ...c,
                    name: document.getElementById('editCustomerName').value,
                    phone: document.getElementById('editCustomerPhone').value
                } : c);
                saveCustomers(updatedCustomers);
                renderCustomers();
                closeModal(editCustomerModal);
            });
            
            customerSalesHistoryModal.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if (btn && btn.classList.contains('view-sale-details-from-customer')) {
                    const saleId = parseInt(btn.dataset.id);
                    const sale = getSales().find(s => s.id === saleId);
                    if (!sale) return;

                    let detailsHtml = `
                        <p><strong>Satƒ±≈ü ID:</strong> ${sale.id}</p>
                        <p><strong>M√º≈üt…ôri:</strong> ${sale.customerName}</p>
                        <p><strong>Satƒ±≈ü N√∂v√º:</strong> ${sale.type}</p>
                        <p><strong>Yekun M…ôbl…ôƒü:</strong> ${sale.totalAmount.toFixed(2)} ‚Çº</p>
                        <p><strong>√ñd…ônilmi≈ü M…ôbl…ôƒü:</strong> ${sale.initialPayment.toFixed(2)} ‚Çº</p>
                        <p><strong>Borc:</strong> ${(sale.totalAmount - sale.initialPayment).toFixed(2)} ‚Çº</p>
                        <hr style="border-color:var(--border-color); margin: 15px 0;">
                        <h4 style="margin-bottom:10px;">Satƒ±lan M…ôhsullar</h4>
                        <table class="data-table" style="width:100%;">
                            <thead><tr><th>M…ôhsul</th><th>Say</th><th>Qiym…ôt</th><th>Toplam</th></tr></thead>
                            <tbody>
                    `;
                    sale.items.forEach(i => {
                        detailsHtml += `<tr><td>${i.name}</td><td>${i.quantity}</td><td>${i.salePrice.toFixed(2)} ‚Çº</td><td>${(i.quantity * i.salePrice).toFixed(2)} ‚Çº</td></tr>`;
                    });
                    detailsHtml += '</tbody></table>';
                    document.getElementById('saleDetailsContent').innerHTML = detailsHtml;
                    openModal(saleDetailsModal);
                }
            });

            customerSearch.addEventListener('input', renderCustomers);
            renderCustomers();
        }

        function setupSuppliersPage() {
            const supplierTableBody = appContainer.querySelector('#supplierTableBody');
            const addSupplierBtn = appContainer.querySelector('#addSupplierBtn');
            const supplierSearch = appContainer.querySelector('#supplierSearch');
            const addSupplierModal = document.getElementById('addSupplierModal');
            const editSupplierModal = document.getElementById('editSupplierModal');
            const addSupplierForm = document.getElementById('addSupplierForm');
            const editSupplierForm = document.getElementById('editSupplierForm');

            const renderSuppliers = () => {
                const query = supplierSearch.value.toLowerCase();
                let suppliers = getSuppliers();
                if(query) {
                    suppliers = suppliers.filter(s => s.name.toLowerCase().includes(query) || (s.phone && s.phone.includes(query)));
                }
                supplierTableBody.innerHTML = '';
                if (suppliers.length === 0) {
                    supplierTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">T…ôchizat√ßƒ± tapƒ±lmadƒ±.</td></tr>';
                    return;
                }
                suppliers.forEach(s => {
                    supplierTableBody.innerHTML += `<tr><td>${s.id}</td><td>${s.name}</td><td>${s.phone || '-'}</td><td>${(s.balance || 0).toFixed(2)} ‚Çº</td><td class="actions-cell"><button class="btn-edit" data-id="${s.id}">‚úèÔ∏è</button><button class="btn-delete" data-id="${s.id}">üóëÔ∏è</button></td></tr>`;
                });
            };

            addSupplierBtn.addEventListener('click', () => { addSupplierForm.reset(); openModal(addSupplierModal); });
            addSupplierForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const suppliers = getSuppliers();
                suppliers.push({
                    id: Date.now(),
                    name: document.getElementById('supplierNameModal').value,
                    phone: document.getElementById('supplierPhoneModal').value,
                    balance: 0
                });
                saveSuppliers(suppliers);
                renderSuppliers();
                closeModal(addSupplierModal);
            });

            supplierTableBody.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if (!btn) return;
                const id = parseInt(btn.dataset.id);

                if (btn.classList.contains('btn-delete')) {
                    const supplier = getSuppliers().find(s => s.id === id);
                    if ((supplier.balance || 0) > 0) {
                        alert('Bu t…ôchizat√ßƒ±ya borc olduƒüu √º√ß√ºn silin…ô bilm…ôz!');
                        return;
                    }
                    if (confirm('T…ôchizat√ßƒ±nƒ± silm…ôy…ô …ôminsiniz?')) {
                        saveSuppliers(getSuppliers().filter(s => s.id !== id));
                        renderSuppliers();
                    }
                }
                if (btn.classList.contains('btn-edit')) {
                    const supplier = getSuppliers().find(s => s.id === id);
                    if (supplier) {
                        document.getElementById('editSupplierId').value = supplier.id;
                        document.getElementById('editSupplierName').value = supplier.name;
                        document.getElementById('editSupplierPhone').value = supplier.phone;
                        openModal(editSupplierModal);
                    }
                }
            });

            editSupplierForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = parseInt(document.getElementById('editSupplierId').value);
                const updatedSuppliers = getSuppliers().map(s => s.id === id ? {
                    ...s,
                    name: document.getElementById('editSupplierName').value,
                    phone: document.getElementById('editSupplierPhone').value
                } : s);
                saveSuppliers(updatedSuppliers);
                renderSuppliers();
                closeModal(editSupplierModal);
            });

            supplierSearch.addEventListener('input', renderSuppliers);
            renderSuppliers();
        }
        
        function setupSalesPage() {
            const saleForm = appContainer.querySelector('#saleForm');
            const saleCustomerSelect = appContainer.querySelector('#saleCustomer');
            const saleProductSelect = appContainer.querySelector('#saleProduct');
            const cartTableBody = appContainer.querySelector('#cartTableBody');
            const summaryTotal = appContainer.querySelector('#summaryTotal');
            const initialPaymentGroup = appContainer.querySelector('#initialPaymentGroup');
            const initialPaymentInput = appContainer.querySelector('#initialPayment');
            const debtRow = appContainer.querySelector('#debt-row');
            const debtTotal = appContainer.querySelector('#debt-total');
            let currentCart = [];
            const saleTypeButtonsContainer = appContainer.querySelector('.sale-type-buttons');
            let selectedSaleType = 'Naƒüd';

            const initializeSalePage = () => {
                const customers = getCustomers();
                saleCustomerSelect.innerHTML = '<option value="">-- M√º≈üt…ôri Se√ßin --</option><option value="0">Naƒüd Alƒ±cƒ±</option>';
                customers.forEach(c => { saleCustomerSelect.innerHTML += `<option value="${c.id}">${c.name}</option>`; });
                const products = getProducts();
                saleProductSelect.innerHTML = '<option value="">-- M…ôhsul ∆èlav…ô Et --</option>';
                products.forEach(p => { if (p.stock > 0) { saleProductSelect.innerHTML += `<option value="${p.id}">${p.name} (Stok: ${p.stock})</option>`; }});
                currentCart = [];
                renderCart();
                saleForm.reset();
                initialPaymentGroup.style.display = 'none';
                debtRow.style.display = 'none';
                saleTypeButtonsContainer.querySelectorAll('.sale-type-btn').forEach(b => b.classList.remove('active'));
                saleTypeButtonsContainer.querySelector('.sale-type-btn[data-type="Naƒüd"]').classList.add('active');
                selectedSaleType = 'Naƒüd';
            };

            const calculateTotals = () => {
                const totalAmount = currentCart.reduce((s, i) => s + (i.quantity * i.salePrice), 0);
                summaryTotal.textContent = `${totalAmount.toFixed(2)} ‚Çº`;
                return totalAmount;
            };

            const renderCart = () => {
                cartTableBody.innerHTML = '';
                if (currentCart.length === 0) {
                    cartTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">S…ôb…ôt bo≈üdur</td></tr>';
                } else {
                    currentCart.forEach(i => {
                        const itemTotal = i.quantity * i.salePrice;
                        cartTableBody.innerHTML += `<tr><td>${i.name}</td><td><input type="number" class="cart-quantity-input" data-id="${i.id}" value="${i.quantity}" min="1" max="${i.stock}"></td><td>${i.salePrice.toFixed(2)} ‚Çº</td><td>${itemTotal.toFixed(2)} ‚Çº</td><td class="actions-cell"><button type="button" class="btn-delete cart-remove-btn" data-id="${i.id}">üóëÔ∏è</button></td></tr>`;
                    });
                }
                calculateTotals();
            };

            saleProductSelect.addEventListener('change', () => {
                const productId = parseInt(saleProductSelect.value);
                if (!productId) return;
                const product = getProducts().find(p => p.id === productId);
                if (!product) return;
                const existingItem = currentCart.find(i => i.id === productId);
                if (existingItem) {
                    if (existingItem.quantity < product.stock) {
                        existingItem.quantity++;
                    } else {
                        alert('Anbarda kifay…ôt q…ôd…ôr m…ôhsul yoxdur!');
                    }
                } else {
                    currentCart.push({ ...product, quantity: 1 });
                }
                renderCart();
                saleProductSelect.value = '';
            });

            cartTableBody.addEventListener('input', (e) => {
                if (e.target.classList.contains('cart-quantity-input')) {
                    const productId = parseInt(e.target.dataset.id);
                    let newQuantity = parseInt(e.target.value);
                    const item = currentCart.find(i => i.id === productId);
                    if (!item) return;

                    if (newQuantity > item.stock) {
                        alert(`Anbarda yalnƒ±z ${item.stock} …ôd…ôd var!`);
                        newQuantity = item.stock;
                        e.target.value = newQuantity;
                    }

                    if (newQuantity < 1) {
                        newQuantity = 1;
                        e.target.value = newQuantity;
                    }
                    
                    item.quantity = newQuantity;
                    renderCart();
                }
            });

            cartTableBody.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if(btn && btn.classList.contains('cart-remove-btn')) {
                    currentCart = currentCart.filter(i => i.id !== parseInt(btn.dataset.id));
                    renderCart();
                }
            });

            saleTypeButtonsContainer.addEventListener('click', (e) => {
                const clickedButton = e.target.closest('.sale-type-btn');
                if (!clickedButton) return;
                saleTypeButtonsContainer.querySelectorAll('.sale-type-btn').forEach(btn => btn.classList.remove('active'));
                clickedButton.classList.add('active');
                selectedSaleType = clickedButton.dataset.type;

                const totalAmount = calculateTotals();
                if (selectedSaleType === 'Kredit' || selectedSaleType === 'Korporativ') {
                    initialPaymentGroup.style.display = 'block';
                    debtRow.style.display = 'flex';
                    initialPaymentInput.value = 0;
                    debtTotal.textContent = `${totalAmount.toFixed(2)} ‚Çº`;
                } else {
                    initialPaymentGroup.style.display = 'none';
                    debtRow.style.display = 'none';
                    initialPaymentInput.value = totalAmount;
                }
            });

            initialPaymentInput.addEventListener('input', () => {
                const totalAmount = calculateTotals();
                const initialPayment = parseFloat(initialPaymentInput.value) || 0;
                const debt = totalAmount - initialPayment;
                debtTotal.textContent = `${debt.toFixed(2)} ‚Çº`;
            });
            
            saleForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (currentCart.length === 0 || !saleCustomerSelect.value) {
                    alert('M√º≈üt…ôri se√ßin v…ô s…ôb…ôt…ô m…ôhsul …ôlav…ô edin!');
                    return;
                }
                const totalAmount = calculateTotals();
                const isCreditType = selectedSaleType === 'Kredit' || selectedSaleType === 'Korporativ';
                const customerId = parseInt(saleCustomerSelect.value);
                const initialPayment = isCreditType ? parseFloat(initialPaymentInput.value || 0) : totalAmount;
                const debt = totalAmount - initialPayment;

                if (isCreditType && customerId === 0) {
                    alert(`${selectedSaleType} satƒ±≈üƒ± √º√ß√ºn "Naƒüd Alƒ±cƒ±" se√ßil…ô bilm…ôz!`);
                    return;
                }

                if (isCreditType && initialPayment > totalAmount) {
                    alert('ƒ∞lkin √∂d…ôni≈ü √ºmumi m…ôbl…ôƒüd…ôn √ßox ola bilm…ôz!');
                    return;
                }
                
                let products = getProducts();
                currentCart.forEach(item => {
                    let product = products.find(p => p.id === item.id);
                    if (product) product.stock -= item.quantity;
                });
                saveProducts(products);

                if (isCreditType && debt > 0) {
                    let customers = getCustomers();
                    let customer = customers.find(c => c.id === customerId);
                    if (customer) customer.debt += debt;
                    saveCustomers(customers);
                }
                
                let sales = getSales();
                let customerName = "Naƒüd Alƒ±cƒ±";
                if (customerId !== 0) {
                    const customer = getCustomers().find(c => c.id === customerId);
                    if (customer) customerName = customer.name;
                    else customerName = "Silinmi≈ü M√º≈üt…ôri";
                }

                const newSale = {
                    id: Date.now(),
                    customerId,
                    customerName,
                    items: currentCart,
                    totalAmount,
                    type: selectedSaleType,
                    initialPayment,
                    date: new Date().toLocaleString('az-AZ')
                };
                sales.push(newSale);
                saveSales(sales);
                
                addTransaction(`${selectedSaleType} Satƒ±≈ü`, `Satƒ±≈ü #${newSale.id} - ${customerName}`, initialPayment);
                
                alert('Satƒ±≈ü uƒüurla tamamlandƒ±!');
                initializeSalePage();
            });

            initializeSalePage();
        }

        function setupPurchasesPage() {
            const purchaseForm = appContainer.querySelector('#purchaseForm');
            const purchaseSupplierSelect = appContainer.querySelector('#purchaseSupplierSelect');
            const purchaseProductSelect = appContainer.querySelector('#purchaseProductSelect');
            const cartTableBody = appContainer.querySelector('#purchaseCartTableBody');
            const purchaseTotalEl = appContainer.querySelector('#purchaseTotal');
            let currentPurchaseCart = [];
            const purchaseDetailsModal = document.getElementById('purchaseDetailsModal');

            const initializePurchasePage = () => {
                const suppliers = getSuppliers();
                purchaseSupplierSelect.innerHTML = '<option value="">-- T…ôchizat√ßƒ± Se√ßin --</option>';
                suppliers.forEach(s => { purchaseSupplierSelect.innerHTML += `<option value="${s.id}">${s.name}</option>`; });
                const products = getProducts();
                purchaseProductSelect.innerHTML = '<option value="">-- M…ôhsul Se√ßin --</option>';
                products.forEach(p => { purchaseProductSelect.innerHTML += `<option value="${p.id}">${p.name}</option>`; });
                currentPurchaseCart = [];
                renderPurchaseCart();
                purchaseForm.reset();
            };

            const calculatePurchaseTotal = () => {
                const total = currentPurchaseCart.reduce((sum, item) => sum + (item.quantity * item.purchasePrice), 0);
                purchaseTotalEl.textContent = `${total.toFixed(2)} ‚Çº`;
                return total;
            };

            const renderPurchaseCart = () => {
                cartTableBody.innerHTML = '';
                if (currentPurchaseCart.length === 0) {
                    cartTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Siyahƒ± bo≈üdur</td></tr>';
                } else {
                    currentPurchaseCart.forEach(item => {
                        const itemTotal = item.quantity * item.purchasePrice;
                        cartTableBody.innerHTML += `<tr><td>${item.name}</td><td><input type="number" value="${item.quantity}" class="purchase-quantity-input" data-id="${item.id}" min="1"></td><td><input type="number" value="${item.purchasePrice.toFixed(2)}" class="purchase-price-input" data-id="${item.id}" step="0.01" min="0"></td><td>${itemTotal.toFixed(2)} ‚Çº</td><td class="actions-cell"><button type="button" class="btn-delete purchase-remove-btn" data-id="${item.id}">üóëÔ∏è</button></td></tr>`;
                    });
                }
                calculatePurchaseTotal();
            };

            purchaseProductSelect.addEventListener('change', () => {
                const productId = parseInt(purchaseProductSelect.value);
                if(!productId) return;
                const product = getProducts().find(p => p.id === productId);
                if(!product) return;
                const existingItem = currentPurchaseCart.find(i => i.id === productId);
                if(existingItem) {
                    existingItem.quantity++;
                } else {
                    currentPurchaseCart.push({ id: product.id, name: product.name, quantity: 1, purchasePrice: product.purchasePrice });
                }
                renderPurchaseCart();
                purchaseProductSelect.value = '';
            });

            cartTableBody.addEventListener('input', (e) => {
                const id = parseInt(e.target.dataset.id);
                const item = currentPurchaseCart.find(i => i.id === id);
                if(!item) return;
                if(e.target.classList.contains('purchase-quantity-input')) {
                    item.quantity = parseInt(e.target.value) || 1;
                }
                if(e.target.classList.contains('purchase-price-input')) {
                    item.purchasePrice = parseFloat(e.target.value) || 0;
                }
                renderPurchaseCart();
            });

            cartTableBody.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if(btn && btn.classList.contains('purchase-remove-btn')) {
                    currentPurchaseCart = currentPurchaseCart.filter(i => i.id !== parseInt(btn.dataset.id));
                    renderPurchaseCart();
                }
            });

            purchaseForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const supplierId = parseInt(purchaseSupplierSelect.value);
                if(!supplierId || currentPurchaseCart.length === 0) {
                    alert("T…ôchizat√ßƒ± se√ßin v…ô siyahƒ±ya m…ôhsul …ôlav…ô edin!");
                    return;
                }

                const totalAmount = calculatePurchaseTotal();
                let products = getProducts();
                let suppliers = getSuppliers();
                const supplier = suppliers.find(s => s.id === supplierId);
                if(!supplier) return;

                currentPurchaseCart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        product.stock += item.quantity;
                        product.purchasePrice = item.purchasePrice;
                    }
                });

                supplier.balance = (supplier.balance || 0) + totalAmount;
                
                const newPurchase = {
                    id: Date.now(),
                    supplierId,
                    supplierName: supplier.name,
                    items: currentPurchaseCart,
                    totalAmount,
                    date: new Date().toLocaleString('az-AZ')
                };

                const purchases = getPurchases();
                purchases.push(newPurchase);
                
                savePurchases(purchases);
                saveProducts(products);
                saveSuppliers(suppliers);
                
                addTransaction('Mal Alƒ±≈üƒ±', `Alƒ±≈ü #${newPurchase.id} - ${supplier.name}`, 0); 
                
                alert('Alƒ±≈ü uƒüurla tamamlandƒ±!');
                initializePurchasePage();
            });

            initializePurchasePage();
        }

        function setupReportsPage() {
            const reportTabs = appContainer.querySelector('#report-tabs');
            const salesReportView = appContainer.querySelector('#sales-report-view');
            const purchasesReportView = appContainer.querySelector('#purchases-report-view');
            const financialReportView = appContainer.querySelector('#financial-report-view');
            const salesHistoryTableBody = appContainer.querySelector('#salesHistoryTableBody');
            const salesReportSearch = appContainer.querySelector('#salesReportSearch');
            const purchasesHistoryTableBody = appContainer.querySelector('#purchasesHistoryTableBody');
            const purchasesReportSearch = appContainer.querySelector('#purchasesReportSearch');
            const financialHistoryTableBody = appContainer.querySelector('#financialHistoryTableBody');
            const financialReportSearch = appContainer.querySelector('#financialReportSearch');
            const saleDetailsModal = document.getElementById('saleDetailsModal');
            const purchaseDetailsModal = document.getElementById('purchaseDetailsModal');
            
            const renderAllSales = () => {
                const query = salesReportSearch.value.toLowerCase();
                let sales = getSales().reverse();
                if (query) {
                    sales = sales.filter(s => s.customerName.toLowerCase().includes(query) || s.totalAmount.toString().includes(query));
                }
                salesHistoryTableBody.innerHTML = '';
                if (sales.length === 0) {
                    salesHistoryTableBody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Satƒ±≈ü tapƒ±lmadƒ±.</td></tr>';
                    return;
                }
                sales.forEach(sale => {
                    salesHistoryTableBody.innerHTML += `<tr><td>${sale.id}</td><td>${sale.date}</td><td>${sale.customerName}</td><td><span style="background:${sale.type === 'Kredit' || sale.type === 'Korporativ' ? 'var(--warning-color)' : 'var(--success-color)'}; color:white; padding: 4px 10px; border-radius:6px; font-size:12px;">${sale.type}</span></td><td>${sale.totalAmount.toFixed(2)} ‚Çº</td><td class="actions-cell"><button class="btn-details" data-id="${sale.id}" data-type="sale">Detallar</button></td></tr>`;
                });
            };

            const renderPurchases = () => {
                const query = purchasesReportSearch.value.toLowerCase();
                let purchases = getPurchases().reverse();
                if (query) {
                    purchases = purchases.filter(p => p.supplierName.toLowerCase().includes(query) || p.totalAmount.toString().includes(query));
                }
                purchasesHistoryTableBody.innerHTML = '';
                if (purchases.length === 0) {
                    purchasesHistoryTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Alƒ±≈ü tapƒ±lmadƒ±.</td></tr>';
                    return;
                }
                purchases.forEach(purchase => {
                    purchasesHistoryTableBody.innerHTML += `<tr><td>${purchase.id}</td><td>${purchase.date}</td><td>${purchase.supplierName}</td><td>${purchase.totalAmount.toFixed(2)} ‚Çº</td><td class="actions-cell"><button class="btn-details" data-id="${purchase.id}" data-type="purchase">Detallar</button></td></tr>`;
                });
            };

            const renderFinancial = () => {
                const query = financialReportSearch.value.toLowerCase();
                let transactions = getTransactions().reverse();
                if (query) {
                    transactions = transactions.filter(t => t.description.toLowerCase().includes(query) || t.type.toLowerCase().includes(query));
                }
                financialHistoryTableBody.innerHTML = '';
                if (transactions.length === 0) {
                    financialHistoryTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">∆èm…ôliyyat tapƒ±lmadƒ±.</td></tr>';
                    return;
                }
                transactions.forEach(tr => {
                    financialHistoryTableBody.innerHTML += `<tr><td>${tr.id}</td><td>${tr.date}</td><td>${tr.type}</td><td>${tr.description}</td><td class="${tr.amount >= 0 ? 'positive' : 'negative'}">${tr.amount.toFixed(2)} ‚Çº</td></tr>`;
                });
            };
            
            reportTabs.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;
                
                reportTabs.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                salesReportView.style.display = 'none';
                purchasesReportView.style.display = 'none';
                financialReportView.style.display = 'none';

                const reportType = button.dataset.report;
                if (reportType === 'sales') {
                    salesReportView.style.display = 'block';
                    renderAllSales();
                } else if (reportType === 'purchases') {
                    purchasesReportView.style.display = 'block';
                    renderPurchases();
                } else if (reportType === 'financial') {
                    financialReportView.style.display = 'block';
                    renderFinancial();
                }
            });

            // Report search listeners
            salesReportSearch.addEventListener('input', renderAllSales);
            purchasesReportSearch.addEventListener('input', renderPurchases);
            financialReportSearch.addEventListener('input', renderFinancial);

            // Detail modal logic
            appContainer.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if (btn && btn.classList.contains('btn-details') && btn.dataset.id) {
                    const id = parseInt(btn.dataset.id);
                    const type = btn.dataset.type;
                    
                    if (type === 'sale') {
                        const sale = getSales().find(s => s.id === id);
                        if (!sale) return;
                        let detailsHtml = `
                            <p><strong>Satƒ±≈ü ID:</strong> ${sale.id}</p>
                            <p><strong>M√º≈üt…ôri:</strong> ${sale.customerName}</p>
                            <p><strong>Satƒ±≈ü N√∂v√º:</strong> ${sale.type}</p>
                            <p><strong>Yekun M…ôbl…ôƒü:</strong> ${sale.totalAmount.toFixed(2)} ‚Çº</p>
                            <p><strong>√ñd…ônilmi≈ü M…ôbl…ôƒü:</strong> ${sale.initialPayment.toFixed(2)} ‚Çº</p>
                            <p><strong>Borc:</strong> ${(sale.totalAmount - sale.initialPayment).toFixed(2)} ‚Çº</p>
                            <hr style="border-color:var(--border-color); margin: 15px 0;">
                            <h4 style="margin-bottom:10px;">Satƒ±lan M…ôhsullar</h4>
                            <table class="data-table" style="width:100%;">
                                <thead><tr><th>M…ôhsul</th><th>Say</th><th>Qiym…ôt</th><th>Toplam</th></tr></thead>
                                <tbody>
                        `;
                        sale.items.forEach(i => {
                            detailsHtml += `<tr><td>${i.name}</td><td>${i.quantity}</td><td>${i.salePrice.toFixed(2)} ‚Çº</td><td>${(i.quantity * i.salePrice).toFixed(2)} ‚Çº</td></tr>`;
                        });
                        detailsHtml += '</tbody></table>';
                        document.getElementById('saleDetailsContent').innerHTML = detailsHtml;
                        openModal(saleDetailsModal);
                    } else if (type === 'purchase') {
                        const purchase = getPurchases().find(p => p.id === id);
                        if (!purchase) return;
                        let detailsHtml = `
                            <p><strong>Alƒ±≈ü ID:</strong> ${purchase.id}</p>
                            <p><strong>T…ôchizat√ßƒ±:</strong> ${purchase.supplierName}</p>
                            <p><strong>Yekun M…ôbl…ôƒü:</strong> ${purchase.totalAmount.toFixed(2)} ‚Çº</p>
                            <hr style="border-color:var(--border-color); margin: 15px 0;">
                            <h4 style="margin-bottom:10px;">Alƒ±nan M…ôhsullar</h4>
                            <table class="data-table" style="width:100%;">
                                <thead><tr><th>M…ôhsul</th><th>Say</th><th>Qiym…ôt</th><th>Toplam</th></tr></thead>
                                <tbody>
                        `;
                        purchase.items.forEach(i => {
                            detailsHtml += `<tr><td>${i.name}</td><td>${i.quantity}</td><td>${i.purchasePrice.toFixed(2)} ‚Çº</td><td>${(i.quantity * i.purchasePrice).toFixed(2)} ‚Çº</td></tr>`;
                        });
                        detailsHtml += '</tbody></table>';
                        document.getElementById('purchaseDetailsContent').innerHTML = detailsHtml;
                        openModal(purchaseDetailsModal);
                    }
                }
            });
            
            // ƒ∞lk d…ôf…ô s…ôhif…ô y√ºkl…ôn…ônd…ô "Satƒ±≈ülar" hesabatƒ±nƒ± g√∂st…ôr
            reportTabs.querySelector('[data-report="sales"]').classList.add('active');
            renderAllSales();
        }

        function setupFinancePage() {
            const currentCashBalanceEl = appContainer.querySelector('#current-cash-balance');
            const totalReceivablesEl = appContainer.querySelector('#total-receivables');
            const totalPayablesEl = appContainer.querySelector('#total-payables');
            const transactionsTableBody = appContainer.querySelector('#transactionsTableBody');
            const btnAcceptPayment = appContainer.querySelector('#btnAcceptPayment');
            const btnAddExpense = appContainer.querySelector('#btnAddExpense');
            const btnPaySupplier = appContainer.querySelector('#btnPaySupplier');
            const btnBackupData = appContainer.querySelector('#btnBackupData');
            const acceptPaymentModal = document.getElementById('acceptPaymentModal');
            const addExpenseModal = document.getElementById('addExpenseModal');
            const paySupplierModal = document.getElementById('paySupplierModal');
            const acceptPaymentForm = document.getElementById('acceptPaymentForm');
            const addExpenseForm = document.getElementById('addExpenseForm');
            const paySupplierForm = document.getElementById('paySupplierForm');
            
            const renderFinancePage = () => {
                const transactions = getTransactions();
                const customers = getCustomers();
                const suppliers = getSuppliers();

                const cashBalance = transactions.reduce((sum, tr) => sum + tr.amount, 0);
                currentCashBalanceEl.textContent = `${cashBalance.toFixed(2)} ‚Çº`;
                currentCashBalanceEl.classList.toggle('negative', cashBalance < 0);
                
                const totalReceivables = customers.reduce((sum, cust) => sum + cust.debt, 0);
                totalReceivablesEl.textContent = `${totalReceivables.toFixed(2)} ‚Çº`;
                
                const totalPayables = suppliers.reduce((sum, sup) => sum + (sup.balance || 0), 0);
                totalPayablesEl.textContent = `${totalPayables.toFixed(2)} ‚Çº`;

                transactionsTableBody.innerHTML = '';
                transactions.slice().reverse().forEach(tr => {
                    transactionsTableBody.innerHTML += `<tr><td>${tr.date}</td><td>${tr.type}</td><td>${tr.description}</td><td class="${tr.amount >= 0 ? 'positive' : 'negative'}">${tr.amount.toFixed(2)} ‚Çº</td></tr>`;
                });
            };

            btnBackupData.addEventListener('click', () => {
                const backupData = {
                    products: getProducts(), customers: getCustomers(), suppliers: getSuppliers(),
                    sales: getSales(), purchases: getPurchases(), transactions: getTransactions()
                };
                const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `biznes-panel-backup-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });

            btnAcceptPayment.addEventListener('click', () => {
                const cDebt = getCustomers().filter(c => c.debt > 0);
                const select = document.getElementById('paymentCustomerSelect');
                select.innerHTML = '<option value="">-- M√º≈üt…ôri Se√ßin --</option>';
                cDebt.forEach(c => { select.innerHTML += `<option value="${c.id}">${c.name} (Borc: ${c.debt.toFixed(2)} ‚Çº)</option>`; });
                acceptPaymentForm.reset();
                openModal(acceptPaymentModal);
            });

            btnAddExpense.addEventListener('click', () => { addExpenseForm.reset(); openModal(addExpenseModal); });

            btnPaySupplier.addEventListener('click', () => {
                const sBal = getSuppliers().filter(s => (s.balance || 0) > 0);
                const select = document.getElementById('paymentSupplierSelect');
                select.innerHTML = '<option value="">-- T…ôchizat√ßƒ± Se√ßin --</option>';
                sBal.forEach(s => { select.innerHTML += `<option value="${s.id}">${s.name} (Borc: ${s.balance.toFixed(2)} ‚Çº)</option>`; });
                paySupplierForm.reset();
                openModal(paySupplierModal);
            });

            acceptPaymentForm.addEventListener('submit', e => {
                e.preventDefault();
                const customerId = parseInt(document.getElementById('paymentCustomerSelect').value);
                if (!customerId) { alert("M√º≈üt…ôri se√ßin."); return; }
                const amount = parseFloat(document.getElementById('paymentAmount').value);
                let customers = getCustomers();
                const customer = customers.find(c => c.id === customerId);
                if (!customer || amount > customer.debt || amount <= 0) {
                    alert('√ñd…ôni≈ü m…ôbl…ôƒüi d√ºzg√ºn deyil!');
                    return;
                }
                customer.debt -= amount;
                saveCustomers(customers);
                addTransaction('M√º≈üt…ôri √ñd…ôni≈üi', `${customer.name} t…ôr…ôfind…ôn √∂d…ôni≈ü`, amount);
                renderFinancePage();
                closeModal(acceptPaymentModal);
            });

            addExpenseForm.addEventListener('submit', e => {
                e.preventDefault();
                const desc = document.getElementById('expenseDescription').value;
                const amount = parseFloat(document.getElementById('expenseAmount').value);
                if(amount <= 0) { alert("M…ôbl…ôƒü m√ºsb…ôt olmalƒ±dƒ±r."); return; }
                addTransaction('X…ôrc', desc, -amount);
                renderFinancePage();
                closeModal(addExpenseModal);
            });

            paySupplierForm.addEventListener('submit', e => {
                e.preventDefault();
                const supplierId = parseInt(document.getElementById('paymentSupplierSelect').value);
                if(!supplierId){ alert("T…ôchizat√ßƒ± se√ßin."); return; }
                const amount = parseFloat(document.getElementById('supplierPaymentAmount').value);
                let suppliers = getSuppliers();
                const supplier = suppliers.find(s => s.id === supplierId);
                if (!supplier || amount > supplier.balance || amount <= 0) {
                    alert('√ñd…ôni≈ü m…ôbl…ôƒüi d√ºzg√ºn deyil!');
                    return;
                }
                supplier.balance -= amount;
                saveSuppliers(suppliers);
                addTransaction('T…ôchizat√ßƒ±ya √ñd…ôni≈ü', `${supplier.name} √º√ß√ºn √∂d…ôni≈ü`, -amount);
                renderFinancePage();
                closeModal(paySupplierModal);
            });

            renderFinancePage();
        }

        renderPage('finance');
    });
    </script>
</body>
</html>
